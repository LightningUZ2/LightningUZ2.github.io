<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Flandre Scarlet 的小屋</title>
  
  <subtitle>LightningUZ 的博客</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://lightninguz2.github.io/"/>
  <updated>2020-04-06T02:51:37.354Z</updated>
  <id>https://lightninguz2.github.io/</id>
  
  <author>
    <name>LightningUZ</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>libreoj 6270 数据结构板子题 题解</title>
    <link href="https://lightninguz2.github.io/2020/04/06/libreoj-6270-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%9D%BF%E5%AD%90%E9%A2%98-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/04/06/libreoj-6270-数据结构板子题-题解/</id>
    <published>2020-04-06T02:30:40.000Z</published>
    <updated>2020-04-06T02:51:37.354Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>给定 $n$ 个区间 $[l_i,r_i]$，和 $Q$ 个询问，每次给你三个整数 $[l,r,k]$，求被 $[l,r]$ 完全包含且长度 $\ge k$ 的区间数量。</p><p>注：定义一个区间  $[l,r]$ 的长度是 $r-l$。 </p><p>$n,q\le 10^6$，$1\le l_i,r_i,l,r,k\le n$，$l_i&lt;r_i,l&lt;r$</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>如果没有 $k$ 的限制，只是要求完全包含的区间数量，可以用两个树状数组，然后计算右端点在 $[1,r]$ 中的数量减去左端点在 $[1,l-1]$ 中的数量。</p><p>然后现在有了 $k$ 的限制，我们把一个询问拆成 $[l,r,r-l]$ 减去 $[l,r,k-1]$。然后把询问和区间都按长度排序，一个一个处理即可。还有就是记录一下这个答案属于第几个询问，带正号还是带负号</p><p>（$[l,r,r-l]$ 带正号，$[l,r,k-1]$ 带负号，看上面答案是怎么算的）</p><p>然后就做完了。</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 1666666</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">I</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">    <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">    <span class="keyword">return</span> (x=(f==<span class="number">1</span>)?x:-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    va_list args; va_start(args,cnt);</span><br><span class="line">    F(i,<span class="number">1</span>,cnt) &#123;<span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);(*x)=I();&#125;</span><br><span class="line">    va_end(args);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BIT</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> tree[N],len;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Build</span><span class="params">(<span class="keyword">int</span> _len)</span> </span>&#123;FK(tree); len=_len;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(pos&lt;=len) tree[pos]+=x,pos+=(pos&amp;(-pos));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Query</span><span class="params">(<span class="keyword">int</span> pos)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(pos&gt;<span class="number">0</span>) ans+=tree[pos],pos-=(pos&amp;(-pos));</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;L,R;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">seg</span>&#123;</span><span class="keyword">int</span> l,r;&#125;a[N]; <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(seg a,seg b)&#123;<span class="keyword">return</span> a.r-a.l&lt;b.r-b.l;&#125;</span><br><span class="line">    <span class="comment">// 给定的线段，按长度排序</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">que</span>&#123;</span><span class="keyword">int</span> l,r,k,id,tp;&#125;q[N]; <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(que a,que b)&#123;<span class="keyword">return</span> a.k&lt;b.k;&#125;</span><br><span class="line"><span class="comment">// 询问，也是按长度排序</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">int</span> n,m; <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Rd(<span class="number">2</span>,&amp;n,&amp;m);</span><br><span class="line">F(i,<span class="number">1</span>,n) &#123;a[i].l=I(); a[i].r=I();&#125;</span><br><span class="line">F(i,<span class="number">1</span>,m) </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> l,r,k; Rd(<span class="number">3</span>,&amp;l,&amp;r,&amp;k);</span><br><span class="line"><span class="keyword">if</span> (k&gt;r-l) <span class="keyword">continue</span>;</span><br><span class="line">q[++cnt]=(que)&#123;l,r,r-l,i,<span class="number">1</span>&#125;; <span class="comment">// 记录编号和符号</span></span><br><span class="line">q[++cnt]=(que)&#123;l,r,k<span class="number">-1</span>,i,<span class="number">-1</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">sort(a+<span class="number">1</span>,a+n+<span class="number">1</span>); sort(q+<span class="number">1</span>,q+cnt+<span class="number">1</span>);</span><br><span class="line">L.Build(n); R.Build(n); <span class="comment">// 两颗树状数组，记录左端点和右端点</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> pos=<span class="number">1</span>;</span><br><span class="line">F(i,<span class="number">1</span>,cnt)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(pos&lt;=n <span class="keyword">and</span> a[pos].r-a[pos].l&lt;=q[i].k) </span><br><span class="line">&#123;</span><br><span class="line">L.Add(a[pos].l,<span class="number">1</span>); R.Add(a[pos].r,<span class="number">1</span>); ++pos;</span><br><span class="line">&#125;</span><br><span class="line">ans[q[i].id]+=q[i].tp*(R.Query(q[i].r)-L.Query(q[i].l<span class="number">-1</span>));</span><br><span class="line">&#125; </span><br><span class="line">F(i,<span class="number">1</span>,m) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans[i]); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line"><span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Input();</span><br><span class="line">Soviet();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Flandre_Scarlet::IsMyWife();</span><br><span class="line">getchar();getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="思维" scheme="https://lightninguz2.github.io/tags/%E6%80%9D%E7%BB%B4/"/>
    
      <category term="树状数组" scheme="https://lightninguz2.github.io/tags/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/"/>
    
  </entry>
  
  <entry>
    <title>bzoj 5102 [POI2018]Prawnicy 题解</title>
    <link href="https://lightninguz2.github.io/2020/04/06/bzoj-5102-POI2018-Prawnicy-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/04/06/bzoj-5102-POI2018-Prawnicy-题解/</id>
    <published>2020-04-06T00:53:40.000Z</published>
    <updated>2020-04-06T01:11:55.948Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[toc]</p><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>给你 $n$ 个区间 $[l_i,r_i]$，选出 <strong>恰好</strong> $k$ 个，使得交集最大。输出最长的长度和方案。</p><p>注：区间 $[l,r]$ 的长度被定义为 $r-l$。</p><p> $1\le k\le n\le 10^5$。 </p><h3 id="思路框架"><a href="#思路框架" class="headerlink" title="思路框架"></a>思路框架</h3><p>若干的区间的交集，显然，左端点是所有左端点的最大值，右端点是所有右端点的最小值。</p><p>然后我们枚举左端点的最大值。怎么枚举呢？按左端点从小到大排序，枚举到 $i$ 表示只能用 $i$ 之前的区间。那么所有的左端点就都 $\le l_i$ 了。</p><p>然后这个时候我们怎么选最大值呢？</p><ol><li>我们只能在 $1\sim i$  中选</li><li>选择 $k$ 个使得最小值最大</li></ol><p>怎么选择 $k$ 个使得最小值最大呢？那肯定是从大到小排序之后选前 $k$ 个啊！然后这时候最大的最小值，就是从大到小之后排第 $k$ 位的数。那么我们现在就是要支持动态插入（无删除）的第 $k$ 大。可以用对顶堆做。</p><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><h4 id="对顶堆如何做"><a href="#对顶堆如何做" class="headerlink" title="对顶堆如何做"></a>对顶堆如何做</h4><p>维护一个小根堆（堆顶是最小值），和一个大根堆（堆顶是最大值）。我们默认把数字插入到小根堆中，如果小根堆中的数字个数 $&gt;k$，那么我们把小根堆中的 <strong>最小值</strong> 放到大根堆里。</p><p>那么有一个显然易证的性质：大根堆中的所有数，任何时候都 $\le$ 小根堆中的所有数。也就是，大根堆的堆顶 $\le$ 小根堆的堆顶。</p><p>而且我们还保证了小根堆中只有 $k$ 个数。那么这 $k$ 个数 $\ge$ 当前的其它所有数，显然，这 $k$ 个数字就是前 $k$ 大。求出这 $k$ 个数中的最小值（小根堆顶），就是当前的第 $k$ 大。</p><p>这个办法也可以用于求中位数 （也就是 $k$ 不一定静态，单调递增的情况也可以求）</p></div></div><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> N 1666666</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> all(a) a.begin(),a.end()</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">I</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">        <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">        <span class="keyword">return</span> (x=(f==<span class="number">1</span>)?x:-x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args; va_start(args,cnt);</span><br><span class="line">        F(i,<span class="number">1</span>,cnt) &#123;<span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);(*x)=I();&#125;</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span><span class="keyword">int</span> l,r,id;&#125; a[N];</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(node a,node b)&#123;<span class="keyword">return</span> a.l&lt;b.l;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span> n,k;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Rd(<span class="number">2</span>,&amp;n,&amp;k);</span><br><span class="line">        F(i,<span class="number">1</span>,n) a[i]=(node)&#123;I(),I(),i&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    priority_queue&lt;<span class="keyword">int</span>,<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;,greater&lt;<span class="keyword">int</span>&gt; &gt; Q1; <span class="comment">// 小根堆</span></span><br><span class="line">    priority_queue&lt;<span class="keyword">int</span>&gt; Q2; <span class="comment">// 大根堆</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        sort(a+<span class="number">1</span>,a+n+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> Max=<span class="number">-0x3f3f3f3f</span>,l,r;</span><br><span class="line">        F(i,<span class="number">1</span>,n)</span><br><span class="line">        &#123;</span><br><span class="line">            Q1.push(a[i].r);</span><br><span class="line">            <span class="keyword">if</span> (sz(Q1)&gt;k) </span><br><span class="line">            <span class="comment">// 其实这里理论上应该是个 while 循环</span></span><br><span class="line">            <span class="comment">// 然而实际上我们每次只会新加入一个数，那么 sz(Q1) 顶多等于 k+1，弹一次即可</span></span><br><span class="line">            <span class="comment">// 写中位数的话，这里要改成 while !</span></span><br><span class="line">            &#123;</span><br><span class="line">                Q2.push(Q1.top()); Q1.pop();</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">            <span class="keyword">if</span> (i&gt;=k) <span class="comment">// 这里注意判一下 i&gt;=k，很重要，会出错！ （我就挂在这的QaQ</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> rr=Q1.top(),ll=a[i].l;</span><br><span class="line">                <span class="keyword">if</span> (rr-ll&gt;Max)</span><br><span class="line">                &#123;</span><br><span class="line">                    Max=rr-ll; l=ll; r=rr;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,Max);</span><br><span class="line">        <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">        F(i,<span class="number">1</span>,n) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i].l&lt;=l <span class="keyword">and</span> r&lt;=a[i].r) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"%d "</span>,a[i].id);</span><br><span class="line">                ++cnt;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (cnt==k) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line">    <span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Input();</span><br><span class="line">        Soviet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Flandre_Scarlet::IsMyWife();</span><br><span class="line">    getchar();getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="优先队列" scheme="https://lightninguz2.github.io/tags/%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/"/>
    
      <category term="贪心" scheme="https://lightninguz2.github.io/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="思维" scheme="https://lightninguz2.github.io/tags/%E6%80%9D%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>libreoj 2037 洛谷 4344 [SHOI2015]脑洞治疗仪 题解</title>
    <link href="https://lightninguz2.github.io/2020/04/01/libreoj-2037-%E6%B4%9B%E8%B0%B7-4344-SHOI2015-%E8%84%91%E6%B4%9E%E6%B2%BB%E7%96%97%E4%BB%AA-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/04/01/libreoj-2037-洛谷-4344-SHOI2015-脑洞治疗仪-题解/</id>
    <published>2020-04-01T14:17:11.000Z</published>
    <updated>2020-04-06T00:54:23.325Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>友链：<a href="https://www.luogu.com.cn/blog/180242/solution-p4344" target="_blank" rel="noopener">zhk 的题解</a></p><p>但是我觉得他这篇里面提的有点简单（主要是没给代码），于是我自己来写一下~</p><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>zps 是又可爱又傻的女孩子！于是她决定自己治疗她的脑子</p><p>zps 的垃圾脑子是一个长度为 $n$ 的序列，每个位置用 $1$ 表示这里有脑组织，$0$ 表示有脑洞（没有脑组织）。初始时全部正常。支持操作若干：</p><p><code>0 l r</code> zps 在 $[l,r]$ 之间所有脑组织都挖掉</p><p><code>1 l0 r0 l1 r1</code> zps 把 $[l_0,r_0]$ 中的脑组织都挖出来，假设有 $K$ 个，那么她会用这些脑洞来填补 $[l_1,r_1]$ 中从左到右前 $K$ 个脑洞。如果还有剩下的脑组织，她会选择直接扔掉</p><p><code>3 l r</code> 询问区间 $[l,r]$ 中，最长连续脑洞长度。</p><p>$1\le n,m\le 2\times 10^5$</p><h3 id="思路框架"><a href="#思路框架" class="headerlink" title="思路框架"></a>思路框架</h3><p>线段树维护。我们整理一下需要哪些操作。</p><p>对于 $0$ 操作，我们需要区间覆盖操作</p><p>对于 $1$ 操作，我们需要求出 $[l_0,r_0]$ 中的脑洞个数 $K$（即维护区间和 $S$），把这一段区间全都覆盖为 $0$，然后还要把 $l_1,r_1$ 的前 $k$ 个脑洞变成脑组织。</p><p>对于 $2$ 操作，我们要支持维护区间的最大连续长度操作。</p><h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><p>要维护区间<strong>脑洞个数</strong> $S$，然后要维护最长左连续脑洞长度 $LC$，右连续脑洞长度 $RC$，还有一个最长连续脑洞长度 $X$。</p><p>$S$ 就是左右加起来，显然。</p><p>如果左儿子的 $LC$ 等于左儿子的长度，那么我们的 $LC$ 跨过整个左半边再加上右儿子的 $LC$。否则 $LC$ 等于左儿子的 $LC$。</p><p>$RC$ 和 $LC$ 类似的，就是判一下能不能跨过整个右半边。</p><p>$X$ 就等于左右儿子 $X$ 的最大值，再和 左 $RC$ 加上右 $LC$ 取 $\max$。</p><p>我们把每个线段树节点封装成一个 <code>struct</code>，然后重载运算符来实现这个合并。</p><h4 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h4><h5 id="区间覆盖"><a href="#区间覆盖" class="headerlink" title="区间覆盖"></a>区间覆盖</h5><p>我们打一个 $C$ 标记 （<code>C=Cover</code>）。然后每次我们先打一下 $C$ 标记，然后如果覆盖的是 $0$（脑洞），$S=LC=RC=X=R-L+1$。否则 $S=LC=RC=X=0$。</p><h5 id="区间填充前-k-个"><a href="#区间填充前-k-个" class="headerlink" title="区间填充前 k 个"></a>区间填充前 k 个</h5><p>把区间分成左右两块，设左半边的脑洞个数为 $lson$。</p><p>如果 $k&lt;=lson$，那么只在左边填即可。</p><p>否则我们就把左半区间整个覆盖上 $1$ （脑组织），然后在右半边填充 $k-lson$ 个。</p><p>线段树上查找的边界为，当：</p><ol><li>当前区间完全被查询区间覆盖</li><li>（且）$k&gt;=S$</li></ol><p>（这种情况显然是直接整个区间覆盖上 $1$ 就行了）</p><p>为了方便写代码，我们填充完 一段区间后，函数返回一个整数，表示成功填充了多少个。 （就是有多少挖出来的脑组织没有被扔掉）。后面就会知道它为啥好写了。</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 255555</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">R</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">    <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">    <span class="keyword">return</span> (x=(f==<span class="number">1</span>)?x:-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    va_list args; va_start(args,cnt);</span><br><span class="line">    F(i,<span class="number">1</span>,cnt) &#123;<span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);(*x)=R();&#125;</span><br><span class="line">    va_end(args);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span><span class="keyword">int</span> l,r,lc,rc,s,x,c;&#125; ;</span><br><span class="line">node <span class="keyword">operator</span>+(node ls,node rs) <span class="comment">// 重载一个加号~</span></span><br><span class="line">&#123;</span><br><span class="line">node t;</span><br><span class="line">t.l=ls.l; t.r=rs.r; t.c=<span class="number">-1</span>;</span><br><span class="line">t.s=ls.s+rs.s;</span><br><span class="line">t.x=max(max(ls.x,rs.x),ls.rc+rs.lc);</span><br><span class="line">t.lc=ls.lc; <span class="keyword">if</span> (ls.lc==ls.r-ls.l+<span class="number">1</span>) t.lc+=rs.lc;</span><br><span class="line">t.rc=rs.rc; <span class="keyword">if</span> (rs.rc==rs.r-rs.l+<span class="number">1</span>) t.rc+=ls.rc;</span><br><span class="line"><span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SegementTree</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">node tree[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls index&lt;&lt;1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs index&lt;&lt;1|1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> L  tree[index].l</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> R  tree[index].r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LC tree[index].lc</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RC tree[index].rc</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S  tree[index].s</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> X  tree[index].x</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> C  tree[index].c</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">(<span class="keyword">int</span> index=<span class="number">1</span>)</span> </span>&#123;tree[index]=tree[ls]+tree[rs];&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> index=<span class="number">1</span>)</span> <span class="comment">// 常规的建树</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">L=l,R=r;</span><br><span class="line"><span class="keyword">if</span> (l==r) &#123;S=X=LC=RC=<span class="number">0</span>; <span class="keyword">return</span>;&#125;</span><br><span class="line"><span class="comment">// 一开始都是脑组织，所以脑洞数量为 0</span></span><br><span class="line"><span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">Build(l,mid,ls); Build(mid+<span class="number">1</span>,r,rs);</span><br><span class="line">Update(index); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CoverOne</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">C=x;</span><br><span class="line"><span class="keyword">if</span> (x==<span class="number">1</span>) &#123;S=X=LC=RC=<span class="number">0</span>;&#125;</span><br><span class="line"><span class="keyword">else</span>   &#123;S=X=LC=RC=R-L+<span class="number">1</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PushDown</span><span class="params">(<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (~C)</span><br><span class="line">&#123;</span><br><span class="line">CoverOne(C,ls); CoverOne(C,rs);</span><br><span class="line">C=<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cover</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> index=<span class="number">1</span>)</span> <span class="comment">// 区间覆盖操作</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (l&gt;R <span class="keyword">or</span> L&gt;r) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">if</span> (l&lt;=L <span class="keyword">and</span> R&lt;=r) <span class="keyword">return</span> CoverOne(x,index);</span><br><span class="line">PushDown(index);</span><br><span class="line">Cover(l,r,x,ls); Cover(l,r,x,rs);</span><br><span class="line">Update(index);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Fill</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> cnt,<span class="keyword">int</span> index=<span class="number">1</span>)</span> <span class="comment">// 区间填充操作</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (l&lt;=L <span class="keyword">and</span> R&lt;=r <span class="keyword">and</span> cnt&gt;=S) </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> s=S;</span><br><span class="line">CoverOne(<span class="number">1</span>,index);</span><br><span class="line"><span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PushDown(index);</span><br><span class="line"><span class="keyword">int</span> mid=(L+R)&gt;&gt;<span class="number">1</span>; <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (r&lt;=mid) sum=Fill(l,r,cnt,ls);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (l&gt;mid) sum=Fill(l,r,cnt,rs);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">sum=Fill(l,mid,cnt,ls); </span><br><span class="line"><span class="keyword">if</span> (cnt&gt;sum) sum+=Fill(mid+<span class="number">1</span>,r,cnt-sum,rs);</span><br><span class="line">&#125;</span><br><span class="line">Update(index);</span><br><span class="line"><span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">node <span class="title">Query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (l&lt;=L <span class="keyword">and</span> R&lt;=r) <span class="keyword">return</span> tree[index];</span><br><span class="line">PushDown(index);</span><br><span class="line"><span class="keyword">int</span> mid=(L+R)&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (r&lt;=mid) <span class="keyword">return</span> Query(l,r,ls);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (l&gt;mid) <span class="keyword">return</span> Query(l,r,rs);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> Query(l,mid,ls)+Query(mid+<span class="number">1</span>,r,rs);</span><br><span class="line">&#125;</span><br><span class="line">&#125;T;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n,q;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Rd(<span class="number">2</span>,&amp;n,&amp;q);</span><br><span class="line">T.Build(<span class="number">1</span>,n);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">F(i,<span class="number">1</span>,q)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> o,l,r; Rd(<span class="number">3</span>,&amp;o,&amp;l,&amp;r);</span><br><span class="line"><span class="keyword">if</span> (o==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">T.Cover(l,r,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (o==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> l2,r2; Rd(<span class="number">2</span>,&amp;l2,&amp;r2);</span><br><span class="line"><span class="keyword">int</span> cnt=(r-l+<span class="number">1</span>)-T.Query(l,r).s;</span><br><span class="line">T.Cover(l,r,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (cnt&gt;<span class="number">0</span>) T.Fill(l2,r2,cnt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (o==<span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,T.Query(l,r).x);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line"><span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Input();</span><br><span class="line">Soviet();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Flandre_Scarlet::IsMyWife();</span><br><span class="line">getchar();getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="线段树" scheme="https://lightninguz2.github.io/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>扩展卢卡斯定理 笔记</title>
    <link href="https://lightninguz2.github.io/2020/03/27/%E6%89%A9%E5%B1%95%E5%8D%A2%E5%8D%A1%E6%96%AF%E5%AE%9A%E7%90%86-%E7%AC%94%E8%AE%B0/"/>
    <id>https://lightninguz2.github.io/2020/03/27/扩展卢卡斯定理-笔记/</id>
    <published>2020-03-27T02:14:20.000Z</published>
    <updated>2020-03-27T04:42:00.385Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>先问一个简单的问题，求：</p><script type="math/tex; mode=display">C_{n}^{m}\pmod {q}</script><p><strong>不保证</strong> $q$ <strong>是质数</strong>。$1\le q\le 10^6,1\le m\le n\le 10^{18}$。</p><p>（<a href="https://www.luogu.com.cn/problem/P4720" target="_blank" rel="noopener">原题：洛谷上的板子</a>）</p><p>这很毒瘤了！我们平常熟知的几个方法，预处理阶乘和阶乘逆元，或者是 <code>Lucas</code> 定理，都需要 $q$ 为质数才能这么干。现在 $q$ 连质数都不是，可咋整呢…</p><h3 id="正片开始"><a href="#正片开始" class="headerlink" title="正片开始"></a>正片开始</h3><p>主题思路</p><ol><li>我们用公式 $C_n^m=\dfrac{n!}{m!(n-m)!}$</li><li>把 $q$ 分解质因数，分解成若干的 $p^k$ 相乘的形式 </li><li>现在假设模数为 $p^k$，求 $C_n^m \pmod {p^k}$</li><li>用中国剩余定理合并答案</li></ol><p>那么，卢卡斯定理呢？引用某神仙写题解时，说过的一句话：</p><blockquote><p>首先，得确定先会扩展欧几里得算法和扩展中国剩余定理。至于卢卡斯定理，那并不重要。</p><p>—— <a href="https://www.luogu.com.cn/user/7035" target="_blank" rel="noopener">Great_Influence 神仙</a></p></blockquote><p>（扩展卢卡斯定理和卢卡斯定理并没有任何关系2333）</p><h4 id="对每个质因数求答案"><a href="#对每个质因数求答案" class="headerlink" title="对每个质因数求答案"></a>对每个质因数求答案</h4><p>我们发现，$n$ 的范围比 $q$ 要大很多。也就是说，分子分母两个阶乘很可能都是 $0$。</p><p>那么就出现了一个想法：我们把分子分母中的含 $p$ 的因子都<strong>单独拿出来</strong>。</p><p>设 $n!$ 中最多包含 $a$ 个 $p$ 因子，$m!$ 和 $(n-m)!$  中分别包含 $b,c$ 个。设 $f(x)$ 表示把 $x!$ 中的 $p$  因子都去掉后的值，于是答案等于</p><script type="math/tex; mode=display">\dfrac{f(n)}{f(m)f(n-m)}\times p^{a-b-c} \pmod{p^k}</script><p>然后现在我们要求两个东西：</p><ol><li>$f(x)$ （定义见上）</li><li>$x!$ 中有多少 $p$ 因子，设为 $g(x)$（这个小学就会了吧，$g(x)=g(x/p)+(x/p)$）</li></ol><p>那怎么求 $f(x)$ 呢？</p><h5 id="第一部分：拿掉所有倍数"><a href="#第一部分：拿掉所有倍数" class="headerlink" title="第一部分：拿掉所有倍数"></a>第一部分：拿掉所有倍数</h5><p>先把所有 $p$ 的倍数都拿掉，大概等于：</p><p>$[1\times 2\times 3\times …\times (p-1)]\times [(p+1)\times (p+2)\times (p+3)…\times (2p-1)]\times …$ </p><p>（一直乘到 $x$ 往下最后一个不是 $p$ 的倍数的数）</p><p>然后你们就会发现我偷偷的把每 $p-1$ 个数分在了同一个中括号里面。我们称这一个中括号为“一组”。组从 $1$ 开始编号（也就是 $1\times 2\times …\times (p-1)$ 是第 $1$ 组，然后剩下的依次编号）</p><p>找一下规律： 第 $x$ 组的积就等于 $[xp-p+1,xp-1]$ 之间的数的积。</p><p>然后考虑 $p^k-1$ 这个数，它显然是第 $p^{k-1}$ 组的最后一个。那它下一组，就是以下这些数的乘积：</p><p>$p^k+1,p^k+2,… p^k+p-1$。</p><p>别忘了我们的 $f(x)$ 模数是 $p^k$ （见上面的式子）。所以，很显然，这些数同余于：</p><p>$1,2,…p-1$</p><p>这和第一组是一样的了。那就出现了 <strong>循环节</strong>！</p><p>我们设“一节”的积为 $S$，那它就等于第 $1$ 组，第 $2$ 组,…第 $p^{k-1}$ 组中的所有数的乘积。</p><p>显然，$x!$ 一共能分出 $\dfrac{x}{p^k}$ 个 $S$。</p><p>当然，还有 $x \bmod {p^k}$ 个不完整的“一节”，设为 $R$。暴力计算即可。</p><p>这一部分的答案（设为 $A$）就等于 $(S)^{\frac{x}{p^k}} \times R$</p><p>那么求 $S$ 和求最后几个不完整的块，就都是 $O(p^k)$ 的了。因为 $q\le 10^6$，所以不会有问题。</p><h5 id="第二部分：只考虑-p-的倍数"><a href="#第二部分：只考虑-p-的倍数" class="headerlink" title="第二部分：只考虑 p 的倍数"></a>第二部分：只考虑 p 的倍数</h5><p>那这一部分就等于</p><p>$p\times 2p \times 3p \times …\times (n/p)p$</p><p>然后我们要去掉所有 $p$ 的因子。于是剩下了一个 $(n/p)!$</p><p>但是我们发现这个玩意要递归计算…于是这一部分答案为 $f(n/p)$</p><h5 id="综上"><a href="#综上" class="headerlink" title="综上"></a>综上</h5><script type="math/tex; mode=display">f(x)=\begin{cases}1\ & (\texttt{if}\quad x=1) \\f(x/p)+A  & (\texttt{else}) \\ \end{cases}</script><p>时间复杂度 $O(p^k\log x)$</p><h4 id="中国剩余定理合并答案"><a href="#中国剩余定理合并答案" class="headerlink" title="中国剩余定理合并答案"></a>中国剩余定理合并答案</h4><p>什么？你中国剩余定理不会？</p><p>额…好的，我会写（gu）博（gu）客（gu）的！</p><h3 id="洛谷上的板子代码"><a href="#洛谷上的板子代码" class="headerlink" title="洛谷上的板子代码"></a>洛谷上的板子代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下注释中的 ^ 均表示幂</span></span><br><span class="line"><span class="comment">// （这个代码里面没有异或.......</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdarg&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 155555</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">R1</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">    <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">    x=(f==<span class="number">1</span>)?x:-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    va_list args;</span><br><span class="line">    va_start(args,cnt);</span><br><span class="line">    F(i,<span class="number">1</span>,cnt) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);R1(*x);</span><br><span class="line">    &#125;</span><br><span class="line">    va_end(args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n,k,p;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Rd(<span class="number">3</span>,&amp;n,&amp;k,&amp;p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> m)</span> <span class="comment">// 快速幂，不用细看，求 a^b%m</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> r=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(b)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (b&amp;<span class="number">1</span>) r=r*a%m;</span><br><span class="line">a=a*a%m,b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exgcd</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> &amp;y)</span> <span class="comment">// exgcd，用来求逆元，以及中国剩余定理</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (b==<span class="number">0</span>) &#123;x=<span class="number">1</span>;y=<span class="number">0</span>;<span class="keyword">return</span>;&#125;</span><br><span class="line"><span class="keyword">int</span> x2,y2;</span><br><span class="line">exgcd(b,a%b,x2,y2);</span><br><span class="line">x=y2; y=x2-(a/b)*y2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">inv</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> p)</span> <span class="comment">// 求 a 模 p 的逆元</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> x,y; exgcd(a,p,x,y);</span><br><span class="line"><span class="keyword">return</span> (x%p+p)%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lcm</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;<span class="keyword">return</span> a/__gcd(a,b)*b;&#125;</span><br><span class="line">    <span class="comment">// 以下函数中的 pk 参数均表示 p^k</span></span><br><span class="line">    <span class="comment">// 分解质因数的时候顺便求的，这样就不用再求一遍快速幂了</span></span><br><span class="line">    <span class="comment">// 常数小~</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fac</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> p,<span class="keyword">int</span> pk)</span> <span class="comment">// 这个就是 f 函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (n==<span class="number">0</span> <span class="keyword">or</span> n==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> r1=<span class="number">1</span>; <span class="comment">// r1 就是上面说的 A，表示完整部分</span></span><br><span class="line">F(i,<span class="number">1</span>,pk) <span class="keyword">if</span> (i%p) r1=(r1*i)%pk;</span><br><span class="line">r1=qpow(r1,n/pk,pk); <span class="comment">// 乘一个 n/pk</span></span><br><span class="line"><span class="keyword">int</span> r2=<span class="number">1</span>; <span class="comment">// r2 就是上面说的 R，表示剩余部分</span></span><br><span class="line">        <span class="comment">// 写解析的时间和上代码的时间并不同步，所以...名字不同，稍微转化下</span></span><br><span class="line">F(i,(n/pk)*pk,n) <span class="keyword">if</span> (i%p) r2=(r2*(i%pk))%pk;</span><br><span class="line"><span class="keyword">return</span> fac(n/p,p,pk)*r1%pk*r2%pk;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">g</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> p)</span> <span class="comment">// 求 n! 中有多少 p 因子</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (n&lt;p) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> n/p+g(n/p,p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">C</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> m,<span class="keyword">int</span> p,<span class="keyword">int</span> pk)</span> <span class="comment">// 求 C(n,m)%pk</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (m&gt;n) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> f1=fac(n,p,pk);</span><br><span class="line"><span class="keyword">int</span> i1=inv(fac(m,p,pk),pk),i2=inv(fac(n-m,p,pk),pk);</span><br><span class="line"><span class="keyword">int</span> gg=g(n,p)-g(m,p)-g(n-m,p);</span><br><span class="line"><span class="keyword">return</span> f1%pk*i1%pk*i2%pk*qpow(p,gg,pk)%pk;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> m[N],a[N];</span><br><span class="line"><span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> c,<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> &amp;y)</span> <span class="comment">// 求方程 ax+by=c 的其中一组特殊解，直接修改 x,y 的值并返回</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> g=__gcd(a,b); </span><br><span class="line"><span class="keyword">if</span> (c%g) &#123;x=<span class="number">-1e9</span>; y=<span class="number">-1e9</span>; <span class="keyword">return</span>;&#125;</span><br><span class="line">a/=g; b/=g; c/=g;</span><br><span class="line">exgcd(a,b,x,y);</span><br><span class="line">x*=c; y*=c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">China</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    <span class="comment">// 中国剩余定理（看这伟大的函数名</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> M=m[<span class="number">1</span>],A=a[<span class="number">1</span>];</span><br><span class="line">F(i,<span class="number">2</span>,cnt)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> x,y;</span><br><span class="line">solve(M,m[i],a[i]-A,x,y);</span><br><span class="line"><span class="keyword">if</span> (x==<span class="number">-1e9</span> <span class="keyword">and</span> y==<span class="number">-1e9</span>) &#123;<span class="keyword">return</span> <span class="number">-1</span>;&#125;</span><br><span class="line">x%=m[i];</span><br><span class="line">A=(A+M*x);</span><br><span class="line">M=lcm(M,m[i]);</span><br><span class="line">A=(A%M+M)%M;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">exLucas</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> k,<span class="keyword">int</span> mod)</span> <span class="comment">// 正片：求 C(n,k)%mod</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cnt=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i*i&lt;=mod;++i) <span class="keyword">if</span> (mod%i==<span class="number">0</span>) <span class="comment">// 分解质因数</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> p=i,pk=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(mod%i==<span class="number">0</span>) pk*=i,mod/=i;</span><br><span class="line">            <span class="comment">// 找到一个质因数，就顺便把 p^k 给求了</span></span><br><span class="line">++cnt;</span><br><span class="line">m[cnt]=pk;</span><br><span class="line">a[cnt]=C(n,k,p,pk)%pk;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (mod!=<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">++cnt;</span><br><span class="line">m[cnt]=mod;</span><br><span class="line">a[cnt]=C(n,k,mod,mod)%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> China();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,exLucas(n,k,p));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line"><span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Input();</span><br><span class="line">Soviet();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> int <span class="comment">//long long</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Flandre_Scarlet::IsMyWife();</span><br><span class="line">getchar();getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="毒瘤" scheme="https://lightninguz2.github.io/tags/%E6%AF%92%E7%98%A4/"/>
    
      <category term="组合数学" scheme="https://lightninguz2.github.io/tags/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>libreoj 10051 「一本通 2.3 例 3」Nikitosh 和异或 </title>
    <link href="https://lightninguz2.github.io/2020/03/26/libreoj%2010051%20%E3%80%8C%E4%B8%80%E6%9C%AC%E9%80%9A-2-3-%E4%BE%8B-3%E3%80%8DNikitosh-%E5%92%8C%E5%BC%82%E6%88%96/"/>
    <id>https://lightninguz2.github.io/2020/03/26/libreoj 10051 「一本通-2-3-例-3」Nikitosh-和异或/</id>
    <published>2020-03-26T12:28:22.000Z</published>
    <updated>2020-03-26T14:08:48.083Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>给一个长度为 $n$ 的序列 $a_1,a_2…a_n$，求两个区间 $[l_1,r_1],[l_2,r_2]$，使得两端区间不相交，且两端区间的异或和加起来最大。</p><p>$n\le 10^5$，每个 $a_i\le 10^9$。</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>设 $s_i$ 为前缀 $i$ 个的异或和。那么 $[l,r]$ 的异或和相当于 $s_r\oplus s_{l-1}$（$\oplus$ 表示异或）。</p><p>设 $pre[i]$ 表示在 $[1,i]$ 中区间的异或和的最大值。$suf[i]$ 表示 $[i,n]$ 中区间的异或和的最大值。那么答案就是 $max\{pre[i]+suf[i+1]\},1\le i\le n-1$。</p><p>然后 $pre$ 和 $suf$ 求法基本相同，如果会求 $pre$，只要反过来求一遍就能求出 $suf$ 了。</p><p>然后我们可以用 <code>01-TRIE</code> 求出必须以 $i$ 为右端点的最大区间异或和。然后求一个前缀最大值，就能得到 $pre$ 数组了。</p><h4 id="如何求（会的跳过）"><a href="#如何求（会的跳过）" class="headerlink" title="如何求（会的跳过）"></a>如何求（会的跳过）</h4><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><p>假设我们当前有一些数。我们把它二进制拆分成 $32$ 位，然后从高到低插入 <code>TRIE</code> 树中。</p><p>现在我们要查询，这些数中哪个和 $x$ 异或起来最大。</p><p>我们把 $x$ 也拆开，对于当前这一位 $x[i]$（其值为 $0/1$），如果有一个儿子编号和 $x[i]$ 不同，尽量往不同的这里走，并且答案加上 $2^i$。否则就只能走相同的那一条边了，因为相同的异或起来为 $0$，所以这时对答案没有贡献。</p><p>我们把 $s[0,1,2\cdots i-1]$ 都插入到 <code>TRIE</code> 树中，然后查询必须选 $s[i]$ 的答案，就能得到以 $i$ 为右端点的最大区间异或和。然后求一遍前缀最大值，就能得到 $pre$ 数组。</p></div></div><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 10000007</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">R1</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">    <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">    x=(f==<span class="number">1</span>)?x:-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    va_list args;</span><br><span class="line">    va_start(args,cnt);</span><br><span class="line">    F(i,<span class="number">1</span>,cnt) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);R1(*x);</span><br><span class="line">    &#125;</span><br><span class="line">    va_end(args);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trie</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">int</span> ch[N][<span class="number">2</span>]; <span class="comment">//01-TRIE 树，儿子编号开 0/1 即可</span></span><br><span class="line"><span class="keyword">int</span> tot;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;FK(ch); tot=<span class="number">0</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> cur=<span class="number">0</span>;</span><br><span class="line">D(i,<span class="number">30</span>,<span class="number">0</span>) </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> id=((x&gt;&gt;i)&amp;<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> (!ch[cur][id]) ch[cur][id]=++tot;</span><br><span class="line">cur=ch[cur][id];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">Query</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> cur=<span class="number">0</span>;<span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">D(i,<span class="number">30</span>,<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> id=((x&gt;&gt;i)&amp;<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> (ch[cur][id^<span class="number">1</span>]) cur=ch[cur][id^<span class="number">1</span>],ans|=(<span class="number">1</span>&lt;&lt;i);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (ch[cur][id]) cur=ch[cur][id];</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line">&#125;T;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n,a[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">R1(n); F(i,<span class="number">1</span>,n) R1(a[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> L[N],R[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">T.Init();</span><br><span class="line">F(i,<span class="number">1</span>,n) </span><br><span class="line">&#123;</span><br><span class="line">L[i]=max(L[i<span class="number">-1</span>],T.Query(a[i])); <span class="comment">// 一边求答案，一边求了前缀最大值</span></span><br><span class="line">T.Insert(a[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">T.Init(); <span class="comment">//注意每次都要把树清空一下</span></span><br><span class="line">D(i,n,<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">R[i]=max(R[i+<span class="number">1</span>],T.Query(a[i]));</span><br><span class="line">T.Insert(a[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> ans=<span class="number">0</span>;</span><br><span class="line">F(i,<span class="number">1</span>,n) ans=max(ans,<span class="number">1l</span>l*L[i]+<span class="number">1l</span>l*R[i+<span class="number">1</span>]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line"><span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Input();</span><br><span class="line">Soviet();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Flandre_Scarlet::IsMyWife();</span><br><span class="line">getchar();getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="思维" scheme="https://lightninguz2.github.io/tags/%E6%80%9D%E7%BB%B4/"/>
    
      <category term="TRIE" scheme="https://lightninguz2.github.io/tags/TRIE/"/>
    
  </entry>
  
  <entry>
    <title>主席树 笔记</title>
    <link href="https://lightninguz2.github.io/2020/03/23/%E4%B8%BB%E5%B8%AD%E6%A0%91-%E7%AC%94%E8%AE%B0/"/>
    <id>https://lightninguz2.github.io/2020/03/23/主席树-笔记/</id>
    <published>2020-03-22T20:30:06.000Z</published>
    <updated>2020-03-25T12:38:39.984Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>对于现在的我来说，只要有“可持久化”这个标签，一定伴随着 “毒瘤“，毕竟我刚学会…</p><p>好的首先介绍一下主席树是啥。主席树是“可持久化线段树”（<code>Persistant Segment Tree</code>）的中文民间俗称。不知道是因为有人把 <code>Persistant</code> 看成了 <code>Presidant</code>，还是因为它的发明者是 <code>HJT</code>（和某一任国家主席简称相同），被叫做“主席树”。</p><p>但是，可持久化是啥呢？</p><h3 id="可持久化是啥"><a href="#可持久化是啥" class="headerlink" title="可持久化是啥"></a>可持久化是啥</h3><p>可持久化是亿点小优化，当你要开 $n$ 个线段树，但是线段树之间只差一次修改的时候，把空间复杂度降到 $O(n\log n)$。</p><p>如何优化呢？考虑我们现在要对一个<strong>单点</strong>进行修改，那么我们能影响到的位置（就是这个点以及它的祖先），一共才 $\log n$ ，个而其它位置都一样，所以我们可以 <strong>只新建 $\log n$  个位置</strong>，整一个副本出来，其余位置直接继承原树即可。</p><p>蒯一张图举个例子，$n=5$，修改了第四个点：</p><p><img src="https://cdn.luogu.com.cn/upload/pic/20234.png" alt></p><p>（<a href="https://www.luogu.com.cn/user/50871" target="_blank" rel="noopener">原作者</a>）</p><p>（<a href="https://www.luogu.com.cn/blog/LonecharmRiver/zhu-xi-shu" target="_blank" rel="noopener">原博客</a>）</p><p>（侵权删）（私信 3348064478@qq.com，本站评论有锅）</p><p>这样就能节省下超级多的空间！</p><p>但是，有利总有弊。这样的结构破坏的原来线段树的编号的完美特性，不能再用 <code>index&lt;&lt;1</code> 和 <code>index&lt;&lt;1|1</code> 来访问左右儿子了。我们要在线段树中多维护两个元素，左儿子和右儿子的编号。</p><h3 id="经典题型"><a href="#经典题型" class="headerlink" title="经典题型"></a>经典题型</h3><p>静态/动态区间第 $k$ 位：给定一个序列，每次给出 $l,r,k$，求 $[l,r]$ 中的数排序后，第 $k$ 个位置的数是谁。（当然，我们不会实际去排序，所以询问操作对原序列没有影响）</p><p>如果是动态的，那你还要支持单点修改的操作，会给定 $x,y$，要支持把第 $x$ 个位置上的数改成 $y$。</p><p>（假设我们离散化过了所有 $a_i$，和所有询问修改后变成的 $y$）</p><h4 id="静态的问题"><a href="#静态的问题" class="headerlink" title="静态的问题"></a>静态的问题</h4><p>板子见 <a href="https://www.luogu.com.cn/problem/P3834" target="_blank" rel="noopener">洛谷 3834</a></p><p>对于一个查询 $(l,r,k)$ ，（假设我们能）把 $a[l\cdots r]$ 拿出来建一颗权值线段树 $T$，查询就很容易了：把区间分成左半部分和右半部分，设左半部分中数字的个数为  $lsum$。如果 $k\le lsum$，那么就在左半部分中查找，否则就在右半部分中查找第 $k-lsum$ 个。</p><p>但是我们怎么把 $a[l\cdots r]$ 拿出来建一颗权值线段树呢？这个时空复杂度都是 $O(nlogn)$ 每次，再乘一个询问次数，肯定炸。</p><p>但是我们发现，线段树满足一种微妙的“可减性”：我们考虑建 $n$ 颗线段树 $T$，$T_i$ 表示 $a[1\cdots i]$ 组成的权值线段树。然后 $a[l\cdots r]$ 组成的权值线段树的对应位置就是 $T_r$ 的对应位置减去 $T_{l-1}$的对应位置。但是把 $T$ 建出来，光空间就够炸的了，是 $O(n^2)$ 的</p><p>考虑用上面“可持久化”的办法来优化求 $T$ 的过程：$T_i$ 和 $T_{i-1}$之间，差的只是在（离散化后的） $a_i$ 位置上加一。那么我们就让 $T_i$ 在 $T_{i-1}$ 的基础上，复制其中的 $\log$ 条链即可。这样就可以空间复杂度 $O(n\log n)$ ，时间复杂度 $O(n\log^2 n)$ 的过去了。</p><h5 id="一个伏笔"><a href="#一个伏笔" class="headerlink" title="一个伏笔"></a>一个伏笔</h5><p>请把它理解成“前缀和套线段树”。</p><p><del>那么恭喜您，现在您已经会了一个嵌套型的数据结构了</del></p><p>关于为什么要把它理解成这样…看到后面就知道啦，现在保密哦，不能告诉你(ฅ&gt;ω&lt;*ฅ) </p><h5 id="静态问题-板子-的代码"><a href="#静态问题-板子-的代码" class="headerlink" title="静态问题(板子)的代码"></a>静态问题(板子)的代码</h5><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;   </span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> N 200005</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">I</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">        <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">        <span class="keyword">return</span> (x=(f==<span class="number">1</span>)?x:-x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args; va_start(args,cnt);</span><br><span class="line">        F(i,<span class="number">1</span>,cnt) &#123;<span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);(*x)=I();&#125;</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Persistant_Tree</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span><span class="keyword">int</span> lid,rid; <span class="keyword">int</span> l,r; <span class="keyword">int</span> s;&#125; t[N&lt;&lt;<span class="number">5</span>];</span><br><span class="line">        <span class="comment">// 注意空间往死里开</span></span><br><span class="line">        <span class="comment">// lid,rid 存储左右儿子编号</span></span><br><span class="line">        <span class="keyword">int</span> rt[N],tot=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">// rt[i] 存第 i 颗线段树的根的编号</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> ls(x) t[x].lid</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rs(x) t[x].rid</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> L  t[rt].l</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> R  t[rt].r</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> S  t[rt].s</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> up(x) t[x].s=t[t[x].lid].s+t[t[x].rid].s</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;tot=<span class="number">0</span>;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">Build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> <span class="comment">// 建树，这一步和普通的线段树差别不大</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> rt=++tot;</span><br><span class="line">            L=l,R=r,S=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (l&lt;r)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">                ls(rt)=Build(l,mid); </span><br><span class="line">                rs(rt)=Build(mid+<span class="number">1</span>,r); </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> rt;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> rt)</span> </span></span><br><span class="line"><span class="function">        <span class="comment">// 在 rt 这个根的基础上，修改了 pos 位置</span></span></span><br><span class="line"><span class="function">        <span class="comment">// 把一路上修改的线段树上的链存一个副本，并返回这个链的顶端</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> rr=++tot;</span><br><span class="line">            t[rr].l=L; t[rr].r=R; t[rr].s=S+<span class="number">1</span>;</span><br><span class="line">            ls(rr)=ls(rt); rs(rr)=rs(rt); <span class="comment">// 默认直接继承</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (L&lt;R)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> mid=(L+R)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (pos&lt;=mid) ls(rr)=Insert(pos,ls(rt)); <span class="comment">// 如果要修改左儿子，那么就左儿子开一个副本</span></span><br><span class="line">                <span class="keyword">else</span>          rs(rr)=Insert(pos,rs(rt)); <span class="comment">// 右儿子同理</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> rr;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">QueryKth</span><span class="params">(<span class="keyword">int</span> r1,<span class="keyword">int</span> r2,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k)</span> <span class="comment">// 在 T[r2]-T[r1] 这颗权值线段树中，查询排名为 k 的位置</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (l==r) <span class="keyword">return</span> l;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> lsum=t[ls(r2)].s-t[ls(r1)].s; <span class="comment">// 左边有多少数</span></span><br><span class="line">            <span class="keyword">if</span> (k&lt;=lsum) <span class="keyword">return</span> QueryKth(ls(r1),ls(r2),l,mid,k); <span class="comment">// k&lt;=lsum，在左边找</span></span><br><span class="line">            <span class="keyword">else</span>         <span class="keyword">return</span> QueryKth(rs(r1),rs(r2),mid+<span class="number">1</span>,r,k-lsum); <span class="comment">// 否则在右边找</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;T;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> n,q,a[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Rd(<span class="number">2</span>,&amp;n,&amp;q);</span><br><span class="line">        F(i,<span class="number">1</span>,n) a[i]=I();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> d[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        F(i,<span class="number">1</span>,n) d[i]=a[i];</span><br><span class="line">        sort(d+<span class="number">1</span>,d+n+<span class="number">1</span>);</span><br><span class="line">        F(i,<span class="number">1</span>,n) a[i]=lower_bound(d+<span class="number">1</span>,d+n+<span class="number">1</span>,a[i])-d;</span><br><span class="line"></span><br><span class="line">        T.Init();</span><br><span class="line">        T.rt[<span class="number">0</span>]=T.Build(<span class="number">1</span>,n);</span><br><span class="line">        F(i,<span class="number">1</span>,n)</span><br><span class="line">        &#123;</span><br><span class="line">            T.rt[i]=T.Insert(a[i],T.rt[i<span class="number">-1</span>]);</span><br><span class="line">            <span class="comment">// 第 i 颗线段树的根，就是在第 i-1 颗线段树的基础上，在 a[i] 的位置上加了一</span></span><br><span class="line">        &#125;</span><br><span class="line">        F(i,<span class="number">1</span>,q)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> l=I(),r=I(),k=I();</span><br><span class="line">            <span class="keyword">int</span> pos=T.QueryKth(T.rt[l<span class="number">-1</span>],T.rt[r],<span class="number">1</span>,n,k);</span><br><span class="line">            <span class="comment">// 查询第 r 颗树减去第 l-1 颗树的第 k 位，就相当于 a[l...r] 中的第 k 位</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,d[pos]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line">    <span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Input();</span><br><span class="line">        Soviet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Flandre_Scarlet::IsMyWife();</span><br><span class="line">    getchar();getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h4 id="动态的问题"><a href="#动态的问题" class="headerlink" title="动态的问题"></a>动态的问题</h4><p>板子见 <a href="https://www.luogu.com.cn/problem/P2617" target="_blank" rel="noopener">洛谷 2617</a></p><p>做好准备，这比静态的问题要困难的多。我当时调试了 $10$ 个小时才过去。</p><h4 id="前置芝士：-树状数组"><a href="#前置芝士：-树状数组" class="headerlink" title="前置芝士： 树状数组"></a>前置芝士： 树状数组</h4><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><blockquote><p> （你不会这个还来学主席树？）</p><p>（算了，还是先复习一下）</p></blockquote><p>首先回顾一下树状数组的概念：</p><p>对于第 $i$ 个位置，我们维护从 $i$ 开始往前 $\operatorname{lowbit}(i)$ 个数的和。然后每次修改只需要改 $\log$ 个位置，</p><p>查询也只要求 $\log$ 个位置的和。</p></div></div><p>为了方便说明，下面设 $nex(i)=i+\operatorname{lowbit}(i)$，$pre(i)=i-\operatorname{lowbit}(i)$</p><p>（才不是因为我懒得打 $\operatorname{lowbit}$ 呢！哼╭(╯^╰)╮）</p><h4 id="故-技-重-施"><a href="#故-技-重-施" class="headerlink" title="故 技 重 施"></a>故 技 重 施</h4><p>动态的问题就是我们要支持对其中一个位置进行修改了。修改 了第 $i$ 个位置后，$[i,n]$ 范围内的所有线段树都要被修改一次，时间复杂度就爆炸了。</p><p>等等，这个问题我们是不是见过一次？</p><p>把时间倒回大约一两年前，我们遇到过这样一个问题：“单点修改，求区间和”</p><p>我们当时是用的树状数组解决的问题：树状数组 $T$，第 $i$ 个位置 $T_i$ 维护 $pre(i)+1$ 到 $i$ 的和。要查询 $i$ 的前缀和，只要求 $T_i,T_{pre(i)},T_{pre(pre(i))}\cdots $ 的和即可。</p><p>那么我们可以用树状数组的思路维护主席树啊！</p><h4 id="总体思路"><a href="#总体思路" class="headerlink" title="总体思路"></a>总体思路</h4><p>那么我们怎么写呢？我们写一个“树状数组套线段树”：维护 $n$ 个线段树 $T$，其中 $T_i$ 维护 $[pre(i)+1,i]$ 之间的所有 $a_{x}$ 组成的权值线段树即可。</p><h5 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h5><p>对于初始化操作，我们建树。先开 $n$ 颗线段树，但是初始的时候 $n$ 颗线段树 <strong>全部</strong> 和初始的线段树共用 （也就是对于每个 $i$，$root[i]=root[0]$）</p><p>然后对于第 $i$ 个位置，它只能影响到 $i,nex(i),nex(nex(i))\cdots $ 位置上的线段树。对于这些位置上的每一个线段树 $T_i$，我们在它 <strong>自己</strong> 的基础上，插入 $a[i]$ 位置（并加一）。</p><h5 id="修改操作"><a href="#修改操作" class="headerlink" title="修改操作"></a>修改操作</h5><p>对于修改第 $x$ 个位置从原来的 $a[x]$ 变成 $y$ （修改完令 $a[x]=y$），我们要找到所有包含它的线段树，$T$，在第 $a[x]$ 个位置 $-1$，在 $y$ 的位置 $+1$，这样就完成了修改操作。</p><h5 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a>查询操作</h5><p>静态的问题中，查询 $[l,r]$ 的第 $k$ 大，用 $T_r$ 来减掉 $T_{l-1}$，然后判断答案在左边还是在右边。传参数只要传入 $T_{l-1}$ 和 $T_r$ 的根节点编号即可。</p><p>然而我们现在是树状数组套线段树，两者相减，可不是两颗线段树相减了，而是</p><p>第 $r,pre(r),pre(pre(r))\cdots$ 颗线段树的和，减去</p><p>第 $l-1,pre(l-1),pre(pre(l-1)) \cdots$ 颗线段树的和。</p><p>然后我们显然没法一次性传这么多参数进去（而且还是不定长度，更麻烦了）。我们的办法是，在查询之前，先把所有的 $l-1,pre(l-1),pre(pre(l-1)) \cdots$ 保存在一个数组 $R_1$ 里，再把所有的 $r,pre(r),pre(pre(r)) \cdots$ 保存在一个数组 $R_2$ 里（并记下这两个数组的长度）（从 $1$ 开始编号的同学可以考虑用第 $0$ 个位置作为长度，我就是这么写的）</p><p>每次查询前缀 $r$ 颗树减去前缀 $l-1$ 颗树的时候，就遍历 $R_1,R_2$，把第 $R_{2i}$ 颗树的对应位置都加起来，把第 $R_{1i}$ 颗树的对应位置都减掉，得到 $lsum$。然后用静态里面的做法即可。</p><h5 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h5><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 100005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">I</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">    <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">    <span class="keyword">return</span> (x=(f==<span class="number">1</span>)?x:-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    va_list args; va_start(args,cnt);</span><br><span class="line">    F(i,<span class="number">1</span>,cnt) &#123;<span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);(*x)=I();&#125;</span><br><span class="line">    va_end(args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Persistant_tree</span> // 被卡常了的主席树...</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span><span class="keyword">int</span> lid,rid,s;&#125; t[N*<span class="number">400</span>];</span><br><span class="line"><span class="comment">// 去掉了存储左右区间的成员变量，左右区间在函数调用过程中记录</span></span><br><span class="line"><span class="comment">// 从而把空间优化成原来的 3/5，然后数组开大点</span></span><br><span class="line"><span class="keyword">int</span> rt[N],tot;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls(x) t[x].lid</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs(x) t[x].rid</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S     t[rt].s</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;tot=<span class="number">0</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> rt=++tot; S=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (l&lt;r)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">ls(rt)=Build(l,mid);</span><br><span class="line">rs(rt)=Build(mid+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> rt;</span><br><span class="line">&#125; <span class="comment">// 这个一样的</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> pos,<span class="keyword">int</span> type,<span class="keyword">int</span> rt)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 修改操作可能会有 -1，于是加上一个 type，type=1或-1表示加还是减</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> rr=++tot;</span><br><span class="line">ls(rr)=ls(rt); rs(rr)=rs(rt); t[rr].s=S+type;</span><br><span class="line"><span class="keyword">if</span> (l&lt;r)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (pos&lt;=mid) ls(rr)=Insert(l,mid,pos,type,ls(rt));</span><br><span class="line"><span class="keyword">else</span>   rs(rr)=Insert(mid+<span class="number">1</span>,r,pos,type,rs(rt));</span><br><span class="line"><span class="comment">// 这些一样的</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> rr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> R2[<span class="number">30</span>],R1[<span class="number">30</span>];</span><br><span class="line"><span class="comment">// R2,R1 含义见上面</span></span><br><span class="line"><span class="comment">// 数组第 0 个位置保存数组长度</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">QueryKth</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (l==r) <span class="keyword">return</span> l;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> lsum=<span class="number">0</span>;</span><br><span class="line">F(i,<span class="number">1</span>,R2[<span class="number">0</span>]) lsum+=t[ls(R2[i])].s;</span><br><span class="line">F(i,<span class="number">1</span>,R1[<span class="number">0</span>]) lsum-=t[ls(R1[i])].s;</span><br><span class="line"><span class="comment">// 这个就是要遍历累加来求出 lsum 的值了</span></span><br><span class="line"><span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (k&lt;=lsum) </span><br><span class="line">&#123;</span><br><span class="line">F(i,<span class="number">1</span>,R2[<span class="number">0</span>]) R2[i]=ls(R2[i]);</span><br><span class="line">F(i,<span class="number">1</span>,R1[<span class="number">0</span>]) R1[i]=ls(R1[i]);</span><br><span class="line"><span class="comment">// 跳左右儿子也要一块跳...这个复杂度活生生的多一个 log 啊</span></span><br><span class="line"><span class="keyword">return</span> QueryKth(l,mid,k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">F(i,<span class="number">1</span>,R2[<span class="number">0</span>]) R2[i]=rs(R2[i]);</span><br><span class="line">F(i,<span class="number">1</span>,R1[<span class="number">0</span>]) R1[i]=rs(R1[i]);</span><br><span class="line"><span class="keyword">return</span> QueryKth(mid+<span class="number">1</span>,r,k-lsum);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;T;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n,m,a[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span><span class="keyword">char</span> type; <span class="keyword">int</span> a,b,c;&#125; q[N];</span><br><span class="line"><span class="comment">// 如果是 C 操作，那么我们只用 a,b，表示将 a 位置变成了 b</span></span><br><span class="line"><span class="comment">// 如果是 Q 操作，那么我们 a,b,c 都用，表示 [a,b] 区间排名第 c 位的数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Rd(<span class="number">2</span>,&amp;n,&amp;m);</span><br><span class="line">F(i,<span class="number">1</span>,n) a[i]=I();</span><br><span class="line">F(i,<span class="number">1</span>,m)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">char</span> o[<span class="number">3</span>]; <span class="built_in">scanf</span>(<span class="string">"%s"</span>,o);</span><br><span class="line"><span class="keyword">if</span> (o[<span class="number">0</span>]==<span class="string">'Q'</span>) </span><br><span class="line">&#123;</span><br><span class="line">q[i]=(node)&#123;o[<span class="number">0</span>],I(),I(),I()&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">q[i]=(node)&#123;o[<span class="number">0</span>],I(),I()&#125;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> d[N&lt;&lt;<span class="number">2</span>],dcnt=<span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Find(x) (lower_bound(d+1,d+dcnt+1,x)-d)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> type)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> x=Find(a[pos]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=pos;i&lt;=n;i+=(i&amp;(-i))) </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> lastr=T.rt[i]; <span class="comment">// 保存原来的根</span></span><br><span class="line">T.rt[i]=T.Insert(<span class="number">1</span>,dcnt,x,type,lastr); <span class="comment">// 以便在原来的基础上插入</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">F(i,<span class="number">0</span>,<span class="number">22</span>) T.R1[i]=T.R2[i]=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=r;i&gt;<span class="number">0</span>;i-=(i&amp;(-i))) T.R2[++T.R2[<span class="number">0</span>]]=T.rt[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&gt;<span class="number">0</span>;i-=(i&amp;(-i))) T.R1[++T.R1[<span class="number">0</span>]]=T.rt[i];</span><br><span class="line"><span class="comment">// 先预先求好 R1,R2</span></span><br><span class="line"><span class="keyword">return</span> T.QueryKth(<span class="number">1</span>,dcnt,k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">F(i,<span class="number">1</span>,n) d[++dcnt]=a[i];</span><br><span class="line">F(i,<span class="number">1</span>,m) <span class="keyword">if</span> (q[i].type==<span class="string">'C'</span>) d[++dcnt]=q[i].b;</span><br><span class="line">sort(d+<span class="number">1</span>,d+dcnt+<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">T.Init();</span><br><span class="line">T.rt[<span class="number">0</span>]=T.Build(<span class="number">1</span>,dcnt); F(i,<span class="number">1</span>,n) T.rt[i]=<span class="number">1</span>;</span><br><span class="line">F(i,<span class="number">1</span>,n) Insert(i,<span class="number">1</span>);</span><br><span class="line">F(i,<span class="number">1</span>,m)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (q[i].type==<span class="string">'Q'</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> pos=Query(q[i].a<span class="number">-1</span>,q[i].b,q[i].c);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,d[pos]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (q[i].type==<span class="string">'C'</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> x=q[i].a,y=q[i].b;</span><br><span class="line">Insert(x,<span class="number">-1</span>); a[x]=y;</span><br><span class="line">Insert(x,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line"><span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Input();</span><br><span class="line">Soviet();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Flandre_Scarlet::IsMyWife();</span><br><span class="line">getchar();getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="毒瘤" scheme="https://lightninguz2.github.io/tags/%E6%AF%92%E7%98%A4/"/>
    
      <category term="线段树" scheme="https://lightninguz2.github.io/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
      <category term="可持久化" scheme="https://lightninguz2.github.io/tags/%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>libreoj 10067 「一本通 3.1 练习 2」构造完全图 题解</title>
    <link href="https://lightninguz2.github.io/2020/03/21/libreoj-10067-%E3%80%8C%E4%B8%80%E6%9C%AC%E9%80%9A-3-1-%E7%BB%83%E4%B9%A0-2%E3%80%8D%E6%9E%84%E9%80%A0%E5%AE%8C%E5%85%A8%E5%9B%BE-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/03/21/libreoj-10067-「一本通-3-1-练习-2」构造完全图-题解/</id>
    <published>2020-03-21T14:49:46.000Z</published>
    <updated>2020-03-21T15:06:06.530Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>给定一个树 $T$ ，求一个完全图 $G$ 使得 $T$ 是 $G$ 的最小生成树，并且 $G$ 的边权和最小。求出这个最小的边权和。$T$ 的点数 $n\le 10^5$，每个边权 $w\le 10^5​$</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>我们把 $T​$ 中的边权排一下序，反向推一下 <code>Kruskal</code> 算法的步骤。</p><p>我们每次考虑到第 $i​$ 条边 $(u,v,w)​$，假设这之前的 $i-1​$ 条边已经构造好了若干个都是完全图的联通块，并且 $T​$ 中的前 $i-1​$ 条边就是这些联通块的生成树（也就是保证了 <code>Kruskal</code> 算法前 $i-1​$ 步都选的是 $T​$ 中的边）。</p><p>在连上 $(u,v,w)$ 之前，$(u,v)$ 应该分在两个联通块里。我们把 $(u,v,w)$ 连起来之后，对于两个联通块里除了 $(u,v)$ 以外的所有点对，都连一条权为 $w+1$ 的边。这样，显然在 <code>Kruskal</code> 算法的第 $i$  步中，选的是第 $i$ 条边（因为现在只剩下两个联通块连接，除了 $(u,v,w)$ 之外所有的边权都 $\ge w$，肯定得选 $(u,v,w)$）</p><p>所以我们把 $T$ 中的边按边权排序，并查集合并的时候记录一下联通块大小。然后 $(u,v,w)$ 这条边的贡献就是 $(cnt[u]\times cnt[v]-1)\times (w+1)​$</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 155555</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">I</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">    <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">    <span class="keyword">return</span> (x=(f==<span class="number">1</span>)?x:-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    va_list args; va_start(args,cnt);</span><br><span class="line">    F(i,<span class="number">1</span>,cnt) &#123;<span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);(*x)=I();&#125;</span><br><span class="line">    va_end(args);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DSU</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">int</span> Fa[N],Cnt[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;F(i,<span class="number">0</span>,N<span class="number">-1</span>) Fa[i]=i,Cnt[i]=<span class="number">1</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">Find</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> u==Fa[u]?u:Fa[u]=Find(Fa[u]);&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Merge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> au=Find(u),av=Find(v); <span class="keyword">if</span> (au==av) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (Cnt[au]&lt;Cnt[av]) Cnt[av]+=Cnt[au],Fa[au]=av;</span><br><span class="line"><span class="keyword">else</span>  Cnt[au]+=Cnt[av],Fa[av]=au;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;D;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span><span class="keyword">int</span> u,v,w;&#125;e[N]; <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(node a,node b)&#123;<span class="keyword">return</span> a.w&lt;b.w;&#125;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">n=I();</span><br><span class="line">F(i,<span class="number">1</span>,n<span class="number">-1</span>) e[i]=(node)&#123;I(),I(),I()&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> ans=<span class="number">0</span>; F(i,<span class="number">1</span>,n<span class="number">-1</span>) ans+=e[i].w; <span class="comment">// 初始答案为所有边的边权和，这个显然</span></span><br><span class="line">sort(e+<span class="number">1</span>,e+n);</span><br><span class="line">D.Init();</span><br><span class="line">F(i,<span class="number">1</span>,n<span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> u=e[i].u,v=e[i].v; <span class="keyword">int</span> au=D.Find(u),av=D.Find(v);</span><br><span class="line">ans+=(D.Cnt[au]*D.Cnt[av]<span class="number">-1</span>)*(e[i].w+<span class="number">1</span>);</span><br><span class="line">D.Merge(u,v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line"><span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Input();</span><br><span class="line">Soviet();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> int <span class="comment">//long long</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Flandre_Scarlet::IsMyWife();</span><br><span class="line">getchar();getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="思维" scheme="https://lightninguz2.github.io/tags/%E6%80%9D%E7%BB%B4/"/>
    
      <category term="生成树" scheme="https://lightninguz2.github.io/tags/%E7%94%9F%E6%88%90%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>洛谷 3831 [SHOI2012]回家的路 题解</title>
    <link href="https://lightninguz2.github.io/2020/03/21/%E6%B4%9B%E8%B0%B7-3831-%5BSHOI2012%5D%E5%9B%9E%E5%AE%B6%E7%9A%84%E8%B7%AF-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/03/21/洛谷-3831-[SHOI2012]回家的路-题解/</id>
    <published>2020-03-21T03:08:00.000Z</published>
    <updated>2020-03-21T15:43:48.341Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>$n$ 行 $n$ 列的矩阵上，只有 $m$ 个“关键点”处（在第 $x$ 行 $y$ 列）才能拐弯。从格子到上下左右四个相邻格子花费 $2$，转弯花费 $1$。 求从某个位置走到另一个位置的最小花费。无解输出 $-1​$。</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>新建两个点 $S$ 和 $T$ 表示起点。 然后把所有点 $A$（包括关键点和 $S,T$） 拆成两个点 $A_1$ 和 $A_2$，分别表示横向跑和纵向跑。</p><p>对于所有关键点 $K$ （不包括 $S,T$），$K_1$ 到 $K_2$ 连一条边权为 $1$ 的无向边，表示换乘。</p><p>然后对于所有同一行 （$x$ 相同）的点，按照列号 $y$ 排序。对于相邻的 $A,B$，连边 $(A_1,B_1,2\times dis)$，其中 $dis$ 为 $A,B$ 两点 $y$ 值的距离。为啥乘二，是因为相邻格子要花费 $2$。 同一列同理（同一列连的是 $A_2$ 和 $B_2$）。</p><p>然后我们从 $S_1$ 跑到 $T_1,T_2$，从 $S_2$ 跑到 $T_1,T_2$ ，四种方案，看哪个最小。如果都不能到达…那就输出 $-1$。</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 255555</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">I</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">    <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">    <span class="keyword">return</span> (x=(f==<span class="number">1</span>)?x:-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    va_list args; va_start(args,cnt);</span><br><span class="line">    F(i,<span class="number">1</span>,cnt) &#123;<span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);(*x)=I();&#125;</span><br><span class="line">    va_end(args);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Graph</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">int</span> head[N];</span><br><span class="line">        <span class="keyword">int</span> EdgeCount;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span></span></span><br><span class="line"><span class="class">        &#123;</span></span><br><span class="line">            <span class="keyword">int</span> To,Label,Next;</span><br><span class="line">        &#125;Ed[<span class="number">1666666</span>];</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> _V=N,<span class="keyword">int</span> _E=N&lt;&lt;<span class="number">1</span>)</span> </span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="built_in">memset</span>(Ed,<span class="number">-1</span>,<span class="keyword">sizeof</span>(Edge)*(_E));</span><br><span class="line">            <span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="keyword">sizeof</span>(<span class="keyword">int</span>)*(_V));</span><br><span class="line">            EdgeCount=<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> w=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            Ed[++EdgeCount]=(Edge)&#123;v,w,head[u]&#125;;</span><br><span class="line">            head[u]=EdgeCount;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Add2</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> w=<span class="number">1</span>)</span> </span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="comment">// printf("Add %d %d\n",u,v);</span></span><br><span class="line">        AddEdge(u,v,w);AddEdge(v,u,w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">Start</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;<span class="keyword">return</span> head[u];&#125;</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">To</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> Ed[u].To;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">Label</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> Ed[u].Label;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">Next</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> Ed[u].Next;&#125;</span><br><span class="line">&#125;G;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span><span class="keyword">int</span> x,y,id;&#125;a[N]; </span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp_x</span><span class="params">(node a,node b)</span> </span>&#123;<span class="keyword">return</span> a.x&lt;b.x <span class="keyword">or</span> (a.x==b.x <span class="keyword">and</span> a.y&lt;b.y);&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp_y</span><span class="params">(node a,node b)</span> </span>&#123;<span class="keyword">return</span> a.y&lt;b.y <span class="keyword">or</span> (a.y==b.y <span class="keyword">and</span> a.x&lt;b.x);&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lin(x) x</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> col(x) (x)+m+2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Rd(<span class="number">2</span>,&amp;n,&amp;m); F(i,<span class="number">1</span>,m) a[i]=(node)&#123;I(),I(),i&#125;;</span><br><span class="line">a[m+<span class="number">1</span>]=(node)&#123;I(),I(),m+<span class="number">1</span>&#125;;</span><br><span class="line">a[m+<span class="number">2</span>]=(node)&#123;I(),I(),m+<span class="number">2</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Build</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">G.clear();</span><br><span class="line">sort(a+<span class="number">1</span>,a+m+<span class="number">3</span>,cmp_x);</span><br><span class="line">F(i,<span class="number">2</span>,m+<span class="number">2</span>) <span class="keyword">if</span> (a[i].x==a[i<span class="number">-1</span>].x) G.Add2(lin(a[i].id),lin(a[i<span class="number">-1</span>].id),<span class="number">2</span>*<span class="built_in">abs</span>(a[i].y-a[i<span class="number">-1</span>].y));</span><br><span class="line">sort(a+<span class="number">1</span>,a+m+<span class="number">3</span>,cmp_y);</span><br><span class="line">F(i,<span class="number">2</span>,m+<span class="number">2</span>) <span class="keyword">if</span> (a[i].y==a[i<span class="number">-1</span>].y) G.Add2(col(a[i].id),col(a[i<span class="number">-1</span>].id),<span class="number">2</span>*<span class="built_in">abs</span>(a[i].x-a[i<span class="number">-1</span>].x));</span><br><span class="line">F(i,<span class="number">1</span>,m+<span class="number">2</span>) <span class="keyword">if</span> (a[i].id&lt;=m) G.Add2(lin(a[i].id),col(a[i].id),<span class="number">1</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">djnode</span>&#123;</span><span class="keyword">int</span> v,w;&#125;; <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(djnode a,djnode b)&#123;<span class="keyword">return</span> a.w&gt;b.w;&#125;</span><br><span class="line">priority_queue&lt;djnode&gt; Q; <span class="keyword">bool</span> vis[N];<span class="keyword">int</span> dis[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dijkstra</span><span class="params">(<span class="keyword">int</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">MEM(dis,<span class="number">0x3f</span>); FK(vis); <span class="keyword">while</span>(!Q.empty()) Q.pop();</span><br><span class="line">Q.push((djnode)&#123;s,<span class="number">0</span>&#125;); dis[s]=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!Q.empty())</span><br><span class="line">&#123;</span><br><span class="line">djnode Min=Q.top(); Q.pop();</span><br><span class="line"><span class="keyword">int</span> u=Min.v;</span><br><span class="line"><span class="keyword">if</span> (vis[u]) <span class="keyword">continue</span>;</span><br><span class="line">vis[u]=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">Tra(i,u) <span class="keyword">if</span> (!vis[v] <span class="keyword">and</span> dis[v]&gt;dis[u]+G.Label(i)) </span><br><span class="line">&#123;</span><br><span class="line">dis[v]=dis[u]+G.Label(i);</span><br><span class="line">Q.push((djnode)&#123;v,dis[v]&#125;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// F(i,1,2*(m+2)) printf("%d ",dis[i]&gt;1e9?-1:dis[i]);</span></span><br><span class="line"><span class="comment">// putchar('\n'); </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Build();</span><br><span class="line"><span class="keyword">int</span> ans=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line">Dijkstra(lin(m+<span class="number">1</span>)); ans=min(ans,min(dis[lin(m+<span class="number">2</span>)],dis[col(m+<span class="number">2</span>)]));</span><br><span class="line">Dijkstra(col(m+<span class="number">1</span>)); ans=min(ans,min(dis[lin(m+<span class="number">2</span>)],dis[col(m+<span class="number">2</span>)]));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans&gt;<span class="number">1e9</span>?<span class="number">-1</span>:ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line"><span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Input();</span><br><span class="line">Soviet();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Flandre_Scarlet::IsMyWife();</span><br><span class="line">getchar();getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="思维" scheme="https://lightninguz2.github.io/tags/%E6%80%9D%E7%BB%B4/"/>
    
      <category term="建图" scheme="https://lightninguz2.github.io/tags/%E5%BB%BA%E5%9B%BE/"/>
    
  </entry>
  
  <entry>
    <title>洛谷 1117 libreoj 2083 优秀的拆分 题解</title>
    <link href="https://lightninguz2.github.io/2020/03/17/%E6%B4%9B%E8%B0%B7-1117-libreoj-2083-%E4%BC%98%E7%A7%80%E7%9A%84%E6%8B%86%E5%88%86-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/03/17/洛谷-1117-libreoj-2083-优秀的拆分-题解/</id>
    <published>2020-03-17T13:39:23.000Z</published>
    <updated>2020-03-17T13:51:50.535Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>一个字符串是“优秀”的，定义为：存在两个<strong>非空</strong>的字符串 $A,B$，满足这个字符串 $S=AABB$，那么这个 $S$ 就是优秀的。</p><p>给定一个串，计算它有多少子串是“优秀”的。相同的子串出现在不同的位置也被算两次。</p><p>长度 $\le 3e4$</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>对于每个位置，我们维护 $pre[i]$ 表示以 $i$ 结尾的 $AA$ 形式的串有多少个，$suf[i]$ 同理。</p><p>然后答案就是 $\prod\limits_{i=1}^{n-1}pre[i]\times suf[i+1]$ </p><p>然后考虑怎么求 $pre$。（$suf$ 的话，就把串反过来求一遍 $pre$ 即可）</p><h4 id="如何求-pre"><a href="#如何求-pre" class="headerlink" title="如何求 pre"></a>如何求 pre</h4><p>不会吧？不会就对了，黑题是这么容易做出来的嘛。 我们继续降低要求，我们求特定长度的 $pre[i]$。我们设 $A$ 的长度为 $k$，也就是 $AA$ 串的长度为 $2k$ 。 这个好判断，哈希就行了。 对于位置 $i$，如果 $[i-k+1,i]$ 区间的哈希值等于区间 $[i-2k+1,i-k]$ 的哈希值，那么 $pre[i]$ 就可以 $+1$，因为长度 $k$ 满足条件。</p><p>但是这样是 $O(n^2)$ 的呀，怎么更快速的求呢。</p><p>假如现在我们枚举 $k$，能很快的求出 $[1,n]$ 的答案，那多好啊。</p><p>那有了这样一个巧妙的做法（看题解前我也不会）：对于长度 $k$，我们在 $k,2k,3k…k\times (n/k)$ 的位置都打上一个标记。显然，标记的总数是 $(n/1)+(n/2)+(n/3)…+(n/n)=n\ln n$。</p><p>而且还有一个特性，一个长度为 $2k$ 的 $AA$ 串，把它分成等长度并且相同的两半，肯定各自覆盖到一个标记。<br><img src="https://lightninguz2.github.io/blogimages/LG1117-1.jpg" alt></p><p>如这个图所示，蓝色是整个大串 $S$，黄色+绿色是一个串 $A$，黄色+绿色+黄色+绿色是一个 $AA$ 串。红色的是两个标记。</p><p>我们发现，黄色部分长度是两个标记的<strong>公共后缀</strong>长度之一，绿色部分则是两个标记的<strong>公共前缀</strong>长度之一。</p><p>对于每个标记，我们求出这个标记和上一个标记的最长公共前缀，和最长公共后缀（二分+哈希）。（当然，这最长公共前后缀的长度不能超过 $k$）设当前位置在 $p$，上一个标记位置是 $p-k$。 子串 $s[p,n]$ 和子串 $s[p-k,n]$ ，最长公共前缀为 $LCP$（<code>Longest Common Prefix</code>），子串 $s[1,p]$ 和子串 $s[1,p-k]$ 的最长公共后缀为 $LCS$。</p><p>那么这个 $AA$ 串，长度为 $2k$，左端点最左能到 $L=p-k-LCS+1$，右端点最右能到 $R=p+LCP-1$。那么这个 $AA$ 的右端点的范围就是 $[L+2k-1,R]$。当然，这个范围不能超过 $P$ ，注意和 $P$ 取一下 $\min$ 或者 $\max$。显然，对于这个区间的所有 $pre$ 数组都能 $+1$。（因为它是一个 $AA$ 串的右端点）</p><p>我们发现，前面都是加法操作，而只要维护一次查询（最后的总查询），用差分即可。</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> N 155555</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> mod 114514027ll <span class="comment">//这模数太臭了</span></span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> int long long </span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">R1</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">        <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">        x=(f==<span class="number">1</span>)?x:-x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args;</span><br><span class="line">        va_start(args,cnt);</span><br><span class="line">        F(i,<span class="number">1</span>,cnt) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);R1(*x);</span><br><span class="line">        &#125;</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> p[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        p[<span class="number">0</span>]=<span class="number">1</span>; F(i,<span class="number">1</span>,<span class="number">1e5</span>) p[i]=(p[i<span class="number">-1</span>]*<span class="number">31</span>)%mod; <span class="comment">// 31为底，质数，保险</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">char</span> a[N]; <span class="keyword">int</span> n;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>,a+<span class="number">1</span>); n=<span class="built_in">strlen</span>(a+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> pre[N];</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">rangehash</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;<span class="keyword">return</span> (pre[l]-pre[r+<span class="number">1</span>]*p[r-l+<span class="number">1</span>]%mod+mod)%mod;&#125; <span class="comment">// 区间哈希值</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">LCS</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span> <span class="comment">//最长公共后缀长度</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (a&gt;b) swap(a,b); </span><br><span class="line">        <span class="keyword">int</span> l=<span class="number">1</span>,r=b-a;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;r)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> mid=(l+r+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (rangehash(a-mid+<span class="number">1</span>,a)==rangehash(b-mid+<span class="number">1</span>,b)) l=mid;</span><br><span class="line">            <span class="keyword">else</span> r=mid<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> l;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">LCP</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span> <span class="comment">// 最长公共前缀长度</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (a&gt;b) swap(a,b);</span><br><span class="line">        <span class="keyword">int</span> l=<span class="number">1</span>,r=b-a;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;r)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> mid=(l+r+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (rangehash(a,a+mid<span class="number">-1</span>)==rangehash(b,b+mid<span class="number">-1</span>)) l=mid;</span><br><span class="line">            <span class="keyword">else</span> r=mid<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> l;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> L[N],R[N];</span><br><span class="line">    <span class="comment">// L 和 R 对应上面说的 suf 和 pre</span></span><br><span class="line">    <span class="comment">// L[i]: 以 i 为左端点（开头）的 AA 串有多少个</span></span><br><span class="line">    <span class="comment">// R[i]: 以 i 为右端点（结尾）的 AA 串有多少个</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rangeadd</span><span class="params">(<span class="keyword">int</span> c[],<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;c[l]++; c[r+<span class="number">1</span>]--;&#125; <span class="comment">// 差分数组 区间加</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        F(i,<span class="number">0</span>,n+<span class="number">1</span>) pre[i]=L[i]=R[i]=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        D(i,n,<span class="number">1</span>) pre[i]=(pre[i+<span class="number">1</span>]*<span class="number">31</span>+(a[i]-<span class="string">'a'</span>+<span class="number">1</span>))%mod;</span><br><span class="line">        F(len,<span class="number">1</span>,n/<span class="number">2</span>) Fs(i,<span class="number">2</span>*len,n,i+=len)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i]!=a[i-len]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> l=i-LCS(i,i-len)+<span class="number">1</span>,r=i+LCP(i,i-len)<span class="number">-1</span>;</span><br><span class="line">            l=max(l+len<span class="number">-1</span>,i);</span><br><span class="line">            r=min(r,i+len<span class="number">-1</span>); <span class="comment">// 和 i 取一下min和max，注意范围</span></span><br><span class="line">            <span class="keyword">if</span> (l&lt;=r) </span><br><span class="line">            &#123;</span><br><span class="line">                rangeadd(R,l<span class="number">-2</span>*len+<span class="number">1</span>,r<span class="number">-2</span>*len+<span class="number">1</span>);</span><br><span class="line">                rangeadd(L,l,r);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        F(i,<span class="number">1</span>,n) L[i]+=L[i<span class="number">-1</span>],R[i]+=R[i<span class="number">-1</span>]; <span class="comment">// 最后可别忘了求前缀和</span></span><br><span class="line">        <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        F(i,<span class="number">1</span>,n<span class="number">-1</span>) ans+=L[i]*R[i+<span class="number">1</span>]; <span class="comment">// 答案式子</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line">    <span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> t;R1(t);</span><br><span class="line">        Init();</span><br><span class="line">        F(i,<span class="number">1</span>,t)</span><br><span class="line">        &#123;</span><br><span class="line">            Input();</span><br><span class="line">            Soviet();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">undef</span> int <span class="comment">//long long </span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Flandre_Scarlet::IsMyWife();</span><br><span class="line">    getchar();getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="毒瘤" scheme="https://lightninguz2.github.io/tags/%E6%AF%92%E7%98%A4/"/>
    
      <category term="思维" scheme="https://lightninguz2.github.io/tags/%E6%80%9D%E7%BB%B4/"/>
    
      <category term="字符串" scheme="https://lightninguz2.github.io/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    
      <category term="哈希" scheme="https://lightninguz2.github.io/tags/%E5%93%88%E5%B8%8C/"/>
    
  </entry>
  
  <entry>
    <title>Codeforces 1235E Ehab&#39;s REAL Number Theory Problem 题解</title>
    <link href="https://lightninguz2.github.io/2020/03/17/Codeforces-1235E-Ehab-s-REAL-Number-Theory-Problem-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/03/17/Codeforces-1235E-Ehab-s-REAL-Number-Theory-Problem-题解/</id>
    <published>2020-03-17T13:03:45.000Z</published>
    <updated>2020-03-17T13:04:15.195Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>考场上想出了思路，但是没能写出来代码，实在可惜</p><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>有 $n\le 1e5$ 个正整数，每个数值域都是 $[1,10^6]$，并且最多有 $7$ 个因数。 请你求出最少选多少个数能使得乘积是平方数。</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>最多 $7$ 个因数 $\leftrightarrow$ 最多两个质因数</p><p>而且对于一个质因数，显然我们还可以把它的指数膜个 $2$。如果指数到最后是 $0$，那么我们直接扔掉这个质因数；如果两个质因数指数都是 $0$，那好了，直接输出 $1$，结束程序。</p><p>然后就是一个数等于 $p$ 或者 $p\times q$ 的情况了。$p$ 的情况就加边 $(1,p)$，$p\times q$ 的情况就加边 $(p,q)$，然后求一个最小环即可。 而且我们发现，一个环上顶多有一个点在 $&gt;1000$ ，那么我们可以以 $1~1000$ 中的点为起点，分别使用 $BFS$ 找环法。这样只能找到包含某个点的最小环，但这足够了，因为这个环必然包含一个编号小于等于 $1000$ 的点。而我们只会在质数间连边，所以我们的实际复杂度比你想象的要小很多！</p><h3 id="怎么想到的"><a href="#怎么想到的" class="headerlink" title="怎么想到的"></a>怎么想到的</h3><p>主要就是如何转换为最小环那一步。首先这个相当于我们选若干个数，分解成 $1\times p$ 或者 $p\times q$ 的形式，然后几个数覆盖起来，每个质数 $p$ 都得被算偶数次（$0$ 也是偶数，不算到也是可以的）。那这样我们的总乘积中，每个质因数都是偶数次方，那就是完全平方数了。</p><p>考虑到一个简单的环上的每个点度数都是 $2$，所以我们就能想到把它建成图，然后跑最小环。那么有小朋友（无 中 生 友）就问了，会不会有环上的点度数为 $4,6,8$，甚至更大的偶数呢？其实这个就相当于一个点被算了很多次嘛，但是我们要求的是“最少多少个数的积是平方数”，也就是我们要让环尽量的小。容易证明，一个最小的环肯定是简单环。（因为如果你是一个复合的环，那么肯定能拆出来若干的简单环，答案更优）</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> N 1666666</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">I</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">        <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">        <span class="keyword">return</span> (x=(f==<span class="number">1</span>)?x:-x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args; va_start(args,cnt);</span><br><span class="line">        F(i,<span class="number">1</span>,cnt) &#123;<span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);(*x)=I();&#125;</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Graph</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">            <span class="keyword">int</span> head[N];</span><br><span class="line">            <span class="keyword">int</span> EdgeCount;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span></span></span><br><span class="line"><span class="class">            &#123;</span></span><br><span class="line">                <span class="keyword">int</span> To,Next;</span><br><span class="line">            &#125;Ed[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> _V=N,<span class="keyword">int</span> _E=N&lt;&lt;<span class="number">1</span>)</span> </span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                <span class="built_in">memset</span>(Ed,<span class="number">-1</span>,<span class="keyword">sizeof</span>(Edge)*(_E));</span><br><span class="line">                <span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="keyword">sizeof</span>(<span class="keyword">int</span>)*(_V));</span><br><span class="line">                EdgeCount=<span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                Ed[++EdgeCount]=(Edge)&#123;v,head[u]&#125;;</span><br><span class="line">                head[u]=EdgeCount;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">Add2</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span> </span>&#123;AddEdge(u,v);AddEdge(v,u);&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">Start</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;<span class="keyword">return</span> head[u];&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">To</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> Ed[u].To;&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">Next</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> Ed[u].Next;&#125;</span><br><span class="line">    &#125;G;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">bool</span> notp[N]; <span class="keyword">int</span> primes[N];;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; pd[N];</span><br><span class="line">    <span class="comment">//prime divisors 的简写，保存质因数</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        notp[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> n=<span class="number">1e6</span>;</span><br><span class="line">        F(i,<span class="number">2</span>,n) <span class="keyword">if</span> (!notp[i]) </span><br><span class="line">        &#123;</span><br><span class="line">            primes[++primes[<span class="number">0</span>]]=i;</span><br><span class="line">            pd[i].p_b(i);</span><br><span class="line">            Fs(j,<span class="number">2</span>*i,n,j+=i) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (sz(pd[j])&lt;<span class="number">2</span>) pd[j].p_b(i);  </span><br><span class="line">                notp[j]=<span class="number">1</span>;</span><br><span class="line">                <span class="comment">// 题目保证质因数个数&lt;=2，只要存前两个即可，空间复杂度O(2n)</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> n,a[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        n=I(); F(i,<span class="number">1</span>,n) a[i]=I();</span><br><span class="line">        sort(a+<span class="number">1</span>,a+n+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span>  <span class="title">cnt</span><span class="params">(<span class="keyword">int</span> p,<span class="keyword">int</span> x)</span> <span class="comment">//计算 x 有多少个因子 p</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ans=<span class="number">0</span>; </span><br><span class="line">        <span class="keyword">while</span>(x%p==<span class="number">0</span>) &#123;ans^=<span class="number">1</span>; x/=p;&#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">bool</span> added[N]; <span class="comment">// 判一下重边</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (added[a*b]) &#123;ans=min(ans,<span class="number">2</span>); <span class="keyword">return</span>;&#125; <span class="comment">//有重边，那就能组成一个二元环，答案更新为 2</span></span><br><span class="line">        added[a*b]=<span class="number">1</span>; G.Add2(a,b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Factor</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x==<span class="number">1</span>) &#123;<span class="built_in">puts</span>(<span class="string">"1"</span>); <span class="built_in">exit</span>(<span class="number">0</span>);&#125;</span><br><span class="line">        <span class="keyword">if</span> (sz(pd[x])==<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> p=pd[x][<span class="number">0</span>],pp=cnt(p,x);</span><br><span class="line">            <span class="keyword">if</span> (pp==<span class="number">0</span>) &#123;ans=min(ans,<span class="number">1</span>);&#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;add(<span class="number">1</span>,p);&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">//pd[x].size()==2</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> p=pd[x][<span class="number">0</span>],q=pd[x][<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">int</span> pp=cnt(p,x),qq=cnt(q,x);</span><br><span class="line">            <span class="keyword">if</span> (pp==<span class="number">0</span> <span class="keyword">and</span> qq==<span class="number">0</span>) &#123;ans=min(ans,<span class="number">1</span>);&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (pp==<span class="number">1</span> <span class="keyword">and</span> qq==<span class="number">1</span>) &#123;add(p,q);&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (pp==<span class="number">0</span> <span class="keyword">and</span> qq==<span class="number">1</span>) &#123;add(<span class="number">1</span>,q);&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (pp==<span class="number">1</span> <span class="keyword">and</span> qq==<span class="number">0</span>) &#123;add(<span class="number">1</span>,p);&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> Q[N],vis[N],dis[N],fa[N]; <span class="keyword">int</span> Round=<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">BFS</span><span class="params">(<span class="keyword">int</span> s)</span> <span class="comment">// 包含 s 的最小环</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> head=<span class="number">1</span>,tail=<span class="number">1</span>;</span><br><span class="line">        ++Round; </span><br><span class="line">        Q[tail]=s; dis[s]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(head&lt;=tail)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> u=Q[head++];</span><br><span class="line">            vis[u]=Round;</span><br><span class="line">            Tra(i,u) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (vis[v]!=Round) &#123;dis[v]=dis[u]+<span class="number">1</span>; vis[v]=Round; Q[++tail]=v; fa[v]=u;&#125;</span><br><span class="line">                <span class="keyword">else</span> </span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (v!=fa[u]) ans=min(ans,dis[u]+dis[v]+<span class="number">1</span>);</span><br><span class="line">                    <span class="comment">// 此时 s-&gt;u,u-&gt;v,v-&gt;s 组成一个环，三个部分长度分别是 dis[u],1,dis[v]，总长度就是 dis[u]+dis[v]+1</span></span><br><span class="line">                    <span class="comment">// 注意不能搜回前驱节点</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        G.clear(); </span><br><span class="line">        F(i,<span class="number">1</span>,n) Factor(a[i]);</span><br><span class="line">        <span class="keyword">if</span> (ans&lt;=<span class="number">2</span>) &#123;<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans); <span class="keyword">return</span>;&#125;</span><br><span class="line">        BFS(<span class="number">1</span>); F(i,<span class="number">1</span>,<span class="number">180</span>) BFS(primes[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans==<span class="number">0x3f3f3f3f</span>?<span class="number">-1</span>:ans);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line">    <span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Init();</span><br><span class="line">        Input();</span><br><span class="line">        Soviet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Flandre_Scarlet::IsMyWife();</span><br><span class="line">    getchar();getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="图论" scheme="https://lightninguz2.github.io/tags/%E5%9B%BE%E8%AE%BA/"/>
    
      <category term="数论" scheme="https://lightninguz2.github.io/tags/%E6%95%B0%E8%AE%BA/"/>
    
      <category term="转化思维" scheme="https://lightninguz2.github.io/tags/%E8%BD%AC%E5%8C%96%E6%80%9D%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>51nod 1238 最小公倍数之和 V3 题解</title>
    <link href="https://lightninguz2.github.io/2020/03/17/51nod-1238-%E6%9C%80%E5%B0%8F%E5%85%AC%E5%80%8D%E6%95%B0%E4%B9%8B%E5%92%8C-V3-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/03/17/51nod-1238-最小公倍数之和-V3-题解/</id>
    <published>2020-03-17T12:38:54.000Z</published>
    <updated>2020-03-17T12:44:46.027Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>$\sum\limits_{i=1}^{n}\sum\limits_{j=1}^{n} \operatorname{lcm}(i,j)$</p><p>$n\le 10^{10}$ （简短题意，恶臭规模）</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>总的来说，就是先把式子变一变，然后巧妙的用欧拉函数 $\varphi$ 加上杜教筛和整除分块来算。</p><h4 id="变形"><a href="#变形" class="headerlink" title="变形"></a>变形</h4><p>首先我们知道 $\operatorname{lcm}(a,b)=\operatorname{lcm}(b,a)$</p><p>所以，当 $i\not=j$ 时候，我们计算 $j&lt;i$ 的情况，然后 $\times 2$ 即可</p><p>对于 $i=j$ 的情况特判，这时候产生的贡献和为 $\dfrac{n(n+1)}{2}$ </p><p>所以，答案化为</p><p>$\sum\limits_{i=1}^{n}\sum\limits_{j=1}^{i-1} \operatorname{lcm}(i,j) + \dfrac{n(n+1)}{2}$</p><p>我们都知道 $\operatorname{lcm}(i,j)=\dfrac{ij}{\gcd(i,j)}$。这个再换一下即可。</p><h4 id="开始硬♂上"><a href="#开始硬♂上" class="headerlink" title="开始硬♂上"></a>开始硬♂上</h4><p>开局一公式，结论全靠推。让我们开心的推倒式子吧~</p><p>首先枚举 $gcd$，然后枚举互质的倍数 $i,j$。</p><p>原式</p><p>$=\sum\limits_{d=1}^{n}\sum\limits_{i=1}^{n/d}\sum\limits_{j=1}^{i} [\gcd(i,j)=1] ijd$<br>$=\sum\limits_{i=1}^{n}\sum\limits_{j=1}^{i} [\gcd(i,j)=1] ij \sum\limits_{d=1}^{n/i} d$ （枚举一对互质的 $i,j$ ，计算有多少个 $d$ 算到了这对 $i,j$，加起来）<br>设 $S_k(n)=\sum\limits_{i=1}^{n} i^k$ 。显然， $k=1,2,3$ 时这个式子都能 $O(1)$ 算。<br>接下来变成<br>$=\sum\limits_{i=1}^{n}\sum\limits_{j=1}^{i}[\gcd(i,j)=1] ij S_1(n/i)$ （恭喜你少了一个 $d$）<br>考虑如何求 $\sum\limits_{j=1}^{i} [\gcd(i,j)=1]j$，也就是求 $i$ 以内和 $i$ 互质的数的和。</p><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><h5 id="如何求-i-以内和-i-互质的数的和（会的跳过）"><a href="#如何求-i-以内和-i-互质的数的和（会的跳过）" class="headerlink" title="如何求 i 以内和 i 互质的数的和（会的跳过）"></a>如何求 i 以内和 i 互质的数的和（会的跳过）</h5><p>首先数量一共有 $\varphi(i)$ 个。<br>然后我们打表发现，这东西和等差数列有一个很类似的性质：我们把 $[1,i]$ 中和 $i$ 互质的 $j$ 从小到大排一排，换一行，再从大到小排一排，对应位置和相等（都是 $i$）！<br>根据高斯当年想出来的办法，和就是（每个对应位置的和）乘以（一共有多少项），然后除二。<br>换到这题来，这个和就是 $\dfrac{1}{2}i\times \varphi(i)$</p></div></div><p>它等于 $\dfrac{1}{2}i\times \varphi(i)$。带入原式：</p><p>$=\sum\limits_{i=1}^{n} i\times S_1(n/i) \times \dfrac{i\times \varphi(i)}{2}$ （恭喜你又少了一个 $j$，它现在是一维了）<br>$=\dfrac{1}{2}\sum\limits_{i=1}^{n} i^2\varphi(i)\times S_1(n/i)$</p><p>$S_1(n/i)$ 显然可以整除分块，但是整除分块我们要考虑一个东西： 如何求 $i^2\varphi(i)$ 的前缀和？显然，用杜教筛求一下和即可。</p><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><h5 id="具体怎么杜教筛-（老样子，会的跳过）"><a href="#具体怎么杜教筛-（老样子，会的跳过）" class="headerlink" title="具体怎么杜教筛 （老样子，会的跳过）"></a>具体怎么杜教筛 （老样子，会的跳过）</h5><p>设 $f(n)=n^2\varphi(n)$<br>关键就是要配一个好算的 $g$ ，使得 $f\times g$ 也是一个好算的函数 $h$。</p><p>由狄利克雷卷积的定义，<br>$h(n)=\sum\limits_{d|n} f(d)g(\dfrac{n}{d})$<br>$=\sum\limits_{d|n} d^2\varphi(i)g(\dfrac{n}{d})$<br>我们发现，令 $g(n)=n^2$，就能消掉一个 $d^2$，原式继续变成：<br>$=\sum\limits_{d|n} n^2\varphi(i)$ （注意 $g(\dfrac{n}{d})$ 头顶上还有一个 $n$，乘出来变成 $n^2$）<br>=$n^2\sum\limits_{d|n} varphi(d)=n^3$</p><p>所以说， $h(n)=f\times (g(n)=n^2)=(n^3)$</p><p>然后用杜教筛的传统艺能就行了。</p></div></div><p>总复杂度非常恐怖，但是的确能通过 $n=10^10$ 的数据。一定注意处处取膜</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> N   20000007ll</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> mod 1000000007ll</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> i6  166666668ll</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> i2  500000004ll</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">I</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">        <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">        <span class="keyword">return</span> (x=(f==<span class="number">1</span>)?x:-x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args; va_start(args,cnt);</span><br><span class="line">        F(i,<span class="number">1</span>,cnt) &#123;<span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);(*x)=I();&#125;</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">bitset</span>&lt;N&gt; notp; <span class="keyword">int</span> primes[N/<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">int</span> phi[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n=<span class="number">2e7</span>;</span><br><span class="line">        notp[<span class="number">1</span>]=<span class="number">1</span>; phi[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> &amp;cnt=primes[<span class="number">0</span>];</span><br><span class="line">        F(i,<span class="number">2</span>,n)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!notp[i]) &#123;primes[++cnt]=i; phi[i]=i<span class="number">-1</span>;&#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=cnt <span class="keyword">and</span> i*primes[j]&lt;=n;++j)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> u=primes[j];</span><br><span class="line">                notp[i*u]=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (i%u==<span class="number">0</span>)&#123;phi[i*u]=phi[i]*u; <span class="keyword">break</span>;&#125;</span><br><span class="line">                <span class="keyword">else</span> phi[i*u]=phi[i]*phi[u];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        F(i,<span class="number">1</span>,n) phi[i]=(phi[i<span class="number">-1</span>]+<span class="number">1l</span>l*phi[i]*i%mod*i%mod)%mod;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        n=I();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; rec; </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">S1</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;n%=mod; <span class="keyword">return</span> <span class="number">1l</span>l*n%mod*(n+<span class="number">1</span>)%mod*i2%mod;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">S2</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;n%=mod; <span class="keyword">return</span> <span class="number">1l</span>l*n%mod*(n+<span class="number">1</span>)%mod*(<span class="number">2l</span>l*n+<span class="number">1</span>)%mod*i6%mod;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">S3</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;n%=mod; <span class="keyword">return</span> <span class="number">1l</span>l*S1(n)*S1(n)%mod;&#125; <span class="comment">// 我就是这里没取膜，调了两小时</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> n)</span> <span class="comment">//杜教筛求 f(n)=n^2*phi(n) 的前缀和</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n&lt;=<span class="number">2e7</span>) <span class="keyword">return</span> phi[n];</span><br><span class="line">        <span class="keyword">if</span> (rec[n]) <span class="keyword">return</span> rec[n];</span><br><span class="line">        <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> l=<span class="number">2</span>,r;l&lt;=n;l=r+<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            r=n/(n/l);</span><br><span class="line">            ans=(ans+f(n/l)*(S2(r)-S2(l<span class="number">-1</span>)))%mod;</span><br><span class="line">        &#125; </span><br><span class="line">        n%=mod;</span><br><span class="line">        <span class="keyword">return</span> rec[n]=(S1(n)*S1(n)-ans)%mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> l=<span class="number">2</span>,r;l&lt;=n;l=r+<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            r=n/(n/l);</span><br><span class="line">            ans=(ans+S1(n/l)*(f(r)-f(l<span class="number">-1</span>))%mod*i2%mod)%mod;</span><br><span class="line">        &#125;<span class="comment">// 整除分块+杜教筛</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,((<span class="number">2l</span>l*ans+S1(n))%mod+mod)%mod);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line">    <span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Init();</span><br><span class="line">        Input();</span><br><span class="line">        Soviet();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">undef</span> int <span class="comment">//long long</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Flandre_Scarlet::IsMyWife();</span><br><span class="line">    getchar();getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="莫比乌斯反演" scheme="https://lightninguz2.github.io/tags/%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%8F%8D%E6%BC%94/"/>
    
      <category term="数论函数" scheme="https://lightninguz2.github.io/tags/%E6%95%B0%E8%AE%BA%E5%87%BD%E6%95%B0/"/>
    
      <category term="毒瘤" scheme="https://lightninguz2.github.io/tags/%E6%AF%92%E7%98%A4/"/>
    
  </entry>
  
  <entry>
    <title>libreoj 137 最小瓶颈路 加强版 题解</title>
    <link href="https://lightninguz2.github.io/2020/03/15/libreoj-137-%E6%9C%80%E5%B0%8F%E7%93%B6%E9%A2%88%E8%B7%AF-%E5%8A%A0%E5%BC%BA%E7%89%88-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/03/15/libreoj-137-最小瓶颈路-加强版-题解/</id>
    <published>2020-03-14T20:19:20.000Z</published>
    <updated>2020-03-14T20:33:17.383Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>给定 $n$ 个点 $m$ 条边的无向连通图，边带权。$q$ 次询问，每次问你 $u,v$ 之间的所有路径中，边权最大值最小是多少。</p><p>$n\le 7\times10^4,m\le 10^5,q\le 10^7$</p><p>（询问会用种子生成方式给你，具体见原题，不会影响输入时间）</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>首先跑一遍 <code>Kruskal</code> 最小生成树的重构树，$u,v$ 的最小瓶颈路就是 $u,v$ 的路径最大值。</p><p>然后在 <code>Kruskal</code> 中，$u,v$ 路径的最大值，就是第一次 （当然，也是唯一一次）把 $u,v$ 两个点从不连通变成联通的那条边的边权。</p><p>那么我们在合并 $u,v$ 的时候，就可以开一个临时的点 $x$ ，把 $u$ 和 $v$ 都接到 $x$ 下面，变成 $x$ 的儿子。然后 $x$ 的点权，就是 $u$ 到 $v$ 的边权。</p><p>那这样求生成树之后， $u$ 到 $v$ 的路径最大值，就相当于 $u,v$ 的 $LCA$ 的点权。</p><p>用 $ST$ 表 $O(1)$ 求 $LCA$ 即可。</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> N   455555</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> mod 1000000007</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">R1</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">        <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">        x=(f==<span class="number">1</span>)?x:-x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args;</span><br><span class="line">        va_start(args,cnt);</span><br><span class="line">        F(i,<span class="number">1</span>,cnt) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);R1(*x);</span><br><span class="line">        &#125;</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DSU</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">int</span> Fa[N],Cnt[N];</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;F(i,<span class="number">0</span>,N<span class="number">-1</span>) Fa[i]=i,Cnt[i]=<span class="number">1</span>;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">int</span>  <span class="title">Find</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> u==Fa[u]?u:Fa[u]=Find(Fa[u]);&#125;</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">Merge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// int au=Find(u),av=Find(v);</span></span><br><span class="line">            <span class="comment">// if (au==av) return false;</span></span><br><span class="line">            <span class="comment">// if (Cnt[au]&lt;Cnt[av]) Cnt[av]+=Cnt[au],Fa[au]=av;</span></span><br><span class="line">            <span class="comment">// else                  Cnt[au]+=Cnt[av],Fa[av]=au;</span></span><br><span class="line">            <span class="comment">// return true;</span></span><br><span class="line">            Fa[Find(v)]=u; <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;D;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Graph</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">            <span class="keyword">int</span> head[N];</span><br><span class="line">            <span class="keyword">int</span> EdgeCount;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span></span></span><br><span class="line"><span class="class">            &#123;</span></span><br><span class="line">                <span class="keyword">int</span> To,Label,Next;</span><br><span class="line">            &#125;Ed[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> _V=N,<span class="keyword">int</span> _E=N&lt;&lt;<span class="number">1</span>)</span> </span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                <span class="built_in">memset</span>(Ed,<span class="number">-1</span>,<span class="keyword">sizeof</span>(Edge)*(_E));</span><br><span class="line">                <span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="keyword">sizeof</span>(<span class="keyword">int</span>)*(_V));</span><br><span class="line">                EdgeCount=<span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> w=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                Ed[++EdgeCount]=(Edge)&#123;v,w,head[u]&#125;;</span><br><span class="line">                head[u]=EdgeCount;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">Add2</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> w=<span class="number">1</span>)</span> </span>&#123;AddEdge(u,v,w);AddEdge(v,u,w);&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">Start</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;<span class="keyword">return</span> head[u];&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">To</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> Ed[u].To;&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">Label</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> Ed[u].Label;&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">Next</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> Ed[u].Next;&#125;</span><br><span class="line">    &#125;G;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span><span class="keyword">int</span> u,v,w;&#125;E[N]; <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(node a,node b)&#123;<span class="keyword">return</span> a.w&lt;b.w;&#125;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Rd(<span class="number">2</span>,&amp;n,&amp;m); F(i,<span class="number">1</span>,m) R1(E[i].u),R1(E[i].v),R1(E[i].w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> val[N];</span><br><span class="line">    <span class="keyword">int</span> seq[N],first[N],deep[N],Time=<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        seq[++Time]=u; first[u]=Time; deep[u]=(u==f)?<span class="number">1</span>:deep[f]+<span class="number">1</span>;</span><br><span class="line">        Tra(i,u) <span class="keyword">if</span> (v!=f)</span><br><span class="line">        &#123;</span><br><span class="line">            DFS(v,u);</span><br><span class="line">            seq[++Time]=u;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> Minp[N][<span class="number">22</span>],lg[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">InitST</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        F(i,<span class="number">2</span>,<span class="number">4e5</span>) lg[i]=lg[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">        F(i,<span class="number">1</span>,Time) Minp[i][<span class="number">0</span>]=seq[i];</span><br><span class="line">        F(j,<span class="number">1</span>,<span class="number">20</span>) F(i,<span class="number">1</span>,Time-(<span class="number">1</span>&lt;&lt;j)+<span class="number">1</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> a=Minp[i][j<span class="number">-1</span>],b=Minp[i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))][j<span class="number">-1</span>];</span><br><span class="line">            Minp[i][j]=(deep[a]&lt;deep[b])?a:b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span>  <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> l=first[u],r=first[v]; <span class="keyword">if</span> (l&gt;r) swap(l,r);</span><br><span class="line">        <span class="keyword">int</span> k=lg[r-l+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">int</span> a=Minp[l][k],b=Minp[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k];</span><br><span class="line">        <span class="keyword">return</span> (deep[a]&lt;deep[b])?a:b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        sort(E+<span class="number">1</span>,E+m+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> cnt=n;</span><br><span class="line">        G.clear(); D.Init();</span><br><span class="line">        F(i,<span class="number">1</span>,m) <span class="keyword">if</span> (D.Find(E[i].u)!=D.Find(E[i].v))</span><br><span class="line">        &#123;</span><br><span class="line">            ++cnt;</span><br><span class="line">            G.AddEdge(cnt,D.Find(E[i].u));</span><br><span class="line">            G.AddEdge(cnt,D.Find(E[i].v));</span><br><span class="line">            D.Merge(cnt,E[i].u); D.Merge(cnt,E[i].v);</span><br><span class="line">            val[cnt]=E[i].w;</span><br><span class="line">        &#125;</span><br><span class="line">        DFS(cnt,cnt);</span><br><span class="line">        InitST();</span><br><span class="line">        <span class="keyword">register</span> <span class="keyword">int</span> q,a,b,c,p;</span><br><span class="line">        Rd(<span class="number">5</span>,&amp;q,&amp;a,&amp;b,&amp;c,&amp;p);</span><br><span class="line">        <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        F(i,<span class="number">1</span>,q)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> u=(a=(a*b+c)%p)%n+<span class="number">1</span>,v=(a=(a*b+c)%p)%n+<span class="number">1</span>;</span><br><span class="line">            ans=(ans+val[LCA(u,v)])%mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line">    <span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Input();</span><br><span class="line">        Soviet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Flandre_Scarlet::IsMyWife();</span><br><span class="line">    getchar();getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="毒瘤" scheme="https://lightninguz2.github.io/tags/%E6%AF%92%E7%98%A4/"/>
    
      <category term="思维" scheme="https://lightninguz2.github.io/tags/%E6%80%9D%E7%BB%B4/"/>
    
      <category term="生成树" scheme="https://lightninguz2.github.io/tags/%E7%94%9F%E6%88%90%E6%A0%91/"/>
    
      <category term="并查集" scheme="https://lightninguz2.github.io/tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/"/>
    
      <category term="ST表" scheme="https://lightninguz2.github.io/tags/ST%E8%A1%A8/"/>
    
  </entry>
  
  <entry>
    <title>洛谷 5308 [COCI2019] Quiz 题解</title>
    <link href="https://lightninguz2.github.io/2020/03/15/%E6%B4%9B%E8%B0%B7-5308-COCI2019-Quiz-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/03/15/洛谷-5308-COCI2019-Quiz-题解/</id>
    <published>2020-03-14T20:07:08.000Z</published>
    <updated>2020-03-14T20:08:11.830Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>有 $n$ 个人，$k$ 轮比赛。每次如果淘汰了 $x$ 个人，还剩下 $m$ 个人，得分增加 $\dfrac{x}{m}$ 的奖金。。假设你能控制每次淘汰多少人，最大化得分。</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>设 $dp[i]$ 表示现在还剩下 $i$ 个人的最优方案 （先不考虑轮数）。</p><p>那么 $dp[i]=max(dp[j]+\dfrac{i-j}{i})$，其中 $0\le j&lt;i$</p><p>显然能斜率优化。</p><p>觉得不显然的小伙伴们看一下：<br><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><p>斜率优化式子：<br>若 $j\ge k$ 且 $j$ 优于 $k$，那么<br>$dp[j]+\dfrac{i-j}{i}&gt;dp[k]+\dfrac{i-k}{i}$<br>$dp[j]-\dfrac{j}{i}&gt;dp[k]-\dfrac{k}{i}$<br>$dp[j]-dp[k]&gt;\dfrac{j-k}{i}$<br>由于 $j\ge k$，所以 $j-k&gt;0$，直接除<br>$\dfrac{dp[j]-dp[k]}{j-k}&gt;\dfrac{1}{i}$</p><p>也就是 $slope(k,j)&gt;\dfrac{1}{i}$ 时，$k$ 就没用了。</p><p>而如果每一个时刻 $k$ 没用了，后面 $i$ 更大，$\dfrac{1}{i}$ 更小，$k$ 更不可能有用。这个是弹队首的条件。</p><p>其次可以看出来，这个队列是斜率单调递减的。这个就是加入队尾的条件。</p></div></div></p><p>然后我们就发现一个问题：$k$ 的限制怎么办？</p><p>上 $wqs$ 二分： 对于每个转移过来的 $j$，我们给他加上一个附加权值 $x$。显然，$x$ 加的越多，选的段数越少。转移的时候记录一下段数，二分即可。</p><p>最后的答案是 $ans-x\times k$，一定要记住了，是 $k$。</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> N 155555</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> EPS 1e-12</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> real long double</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">R1</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">        <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">        x=(f==<span class="number">1</span>)?x:-x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args;</span><br><span class="line">        va_start(args,cnt);</span><br><span class="line">        F(i,<span class="number">1</span>,cnt) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);R1(*x);</span><br><span class="line">        &#125;</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> n,k;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Rd(<span class="number">2</span>,&amp;n,&amp;k);</span><br><span class="line">    &#125;</span><br><span class="line">    real dp[N]; <span class="keyword">int</span> cnt[N];</span><br><span class="line">    <span class="function">real <span class="title">slope</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;<span class="keyword">return</span> (dp[x]-dp[y])/(<span class="number">1.0</span>*x<span class="number">-1.0</span>*y);&#125;</span><br><span class="line">    <span class="keyword">int</span> Q[N];</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">cxk</span><span class="params">(real mid)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> head=<span class="number">1</span>,tail=<span class="number">1</span>; Q[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">        F(i,<span class="number">1</span>,n)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span>(head+<span class="number">1</span>&lt;=tail <span class="keyword">and</span> slope(Q[head+<span class="number">1</span>],Q[head])<span class="number">-1.0</span>/i&gt;EPS) ++head;</span><br><span class="line">            <span class="keyword">int</span> j=Q[head];</span><br><span class="line">            dp[i]=dp[j]+(<span class="number">1.0</span>*i<span class="number">-1.0</span>*j)/(<span class="number">1.0</span>*i)-mid; cnt[i]=cnt[j]+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(head&lt;=tail<span class="number">-1</span> <span class="keyword">and</span> slope(Q[tail<span class="number">-1</span>],Q[tail])-slope(Q[tail],i)&lt;-EPS) --tail;</span><br><span class="line">            Q[++tail]=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt[n]&gt;=k;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        real l=<span class="number">0.00</span>,r=<span class="number">1e6</span>;</span><br><span class="line">        F(i,<span class="number">1</span>,<span class="number">100</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            real mid=(l+r)/<span class="number">2.0</span>; </span><br><span class="line">            <span class="keyword">if</span> (cxk(mid)) l=mid;</span><br><span class="line">            <span class="keyword">else</span> r=mid;</span><br><span class="line">        &#125;</span><br><span class="line">        cxk(l);</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;fixed&lt;&lt;setprecision(<span class="number">9</span>)&lt;&lt;dp[n]+k*l&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line">    <span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Input();</span><br><span class="line">        Soviet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Flandre_Scarlet::IsMyWife();</span><br><span class="line">    getchar();getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="毒瘤" scheme="https://lightninguz2.github.io/tags/%E6%AF%92%E7%98%A4/"/>
    
      <category term="wqs二分" scheme="https://lightninguz2.github.io/tags/wqs%E4%BA%8C%E5%88%86/"/>
    
      <category term="斜率优化" scheme="https://lightninguz2.github.io/tags/%E6%96%9C%E7%8E%87%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>Codeforces 1252K Addition Robot 题解</title>
    <link href="https://lightninguz2.github.io/2020/03/15/Codeforces-1252K-Addition-Robot-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/03/15/Codeforces-1252K-Addition-Robot-题解/</id>
    <published>2020-03-14T19:49:54.000Z</published>
    <updated>2020-03-14T19:50:33.730Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>你有一个字符串，仅由 <code>A,B</code> 两种字符构成。长度 $n\le 10^5$。维护 $Q$ 次操作，格式为：<br><code>1 L R</code>  区间 $[L,R]$ 中，$A$ 变成 $B$，$B$ 变成 $A$。<br><code>2 L R A B</code> 你有两个数，初始是 $A$ 和 $B$。从 $L$ 遍历到 $R$ ，如果这一位是字符 <code>A</code>，那么 $A=A+B$，否则 $B=A+B$，输出最后 $A$ 和 $B$ 变成什么样。</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><script type="math/tex; mode=display">[A+B,B]=[A,B]\times \begin{bmatrix}1 & 0\\1 & 1\end{bmatrix}</script><script type="math/tex; mode=display">[A,A+B]=[A,B]\times \begin{bmatrix}1 & 1\\0 & 1\end{bmatrix}</script><p>线段树区间维护矩阵积，然后用 $[A,B]$ 左乘这个矩阵积，就能得到最后的 $A,B$。</p><p>关于交换操作：我们维护矩阵积的时候，维护取反后的矩阵积 （就是把 $A$ 变成 $B$ ，把 $B$ 变成 $A$ 后的矩阵积）。交换的时候，把两个矩阵积换一下，然后下传标记即可。</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> N 155555</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> mod 1000000007</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">R1</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">        <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">        x=(f==<span class="number">1</span>)?x:-x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args;</span><br><span class="line">        va_start(args,cnt);</span><br><span class="line">        F(i,<span class="number">1</span>,cnt) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);R1(*x);</span><br><span class="line">        &#125;</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Matrix</span> //矩阵</span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> S 5</span></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="keyword">int</span> a[S][S];</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line">        Matrix()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="keyword">sizeof</span>(a));</span><br><span class="line">            n=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Matrix(<span class="keyword">int</span> _n)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="keyword">sizeof</span>(a));</span><br><span class="line">            n=_n;</span><br><span class="line">        &#125;</span><br><span class="line">        Matrix(<span class="keyword">int</span> _n,<span class="keyword">int</span> _x)</span><br><span class="line">        &#123;</span><br><span class="line">            n=_n;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;S;++i)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;S;++j)</span><br><span class="line">                &#123;</span><br><span class="line">                    a[i][j]=_x;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>* <span class="keyword">operator</span>[](<span class="keyword">int</span> i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> *(a+i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Identity</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="keyword">sizeof</span>(a));</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;S;++i)</span><br><span class="line">            &#123;</span><br><span class="line">                a[i][i]=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">undef</span> S <span class="comment">//5</span></span></span><br><span class="line">    &#125;A(<span class="number">2</span>,<span class="number">1</span>),B(<span class="number">2</span>,<span class="number">1</span>),I(<span class="number">2</span>,<span class="number">0</span>); </span><br><span class="line">    <span class="comment">// A: A=A+B 的变换矩阵</span></span><br><span class="line">    <span class="comment">// B: B=A+B 的变换矩阵</span></span><br><span class="line">    <span class="comment">// I: 单位矩阵</span></span><br><span class="line">    Matrix <span class="keyword">operator</span>*(Matrix x,Matrix y) <span class="comment">//并不需要用到快速幂的操作,于是我没写</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">Matrix <span class="title">ans</span><span class="params">(x.n,<span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="keyword">int</span> n=ans.n;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;++j)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (x[i][j])</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">1</span>;k&lt;=n;++k)</span><br><span class="line">                    &#123;</span><br><span class="line">                        ans[i][k]=(ans[i][k]+<span class="number">1l</span>l*x[i][j]*y[j][k]%mod)%mod;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">char</span> a[N];</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">SegmentTree</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span><span class="keyword">int</span> l,r; <span class="keyword">bool</span> c; Matrix w[<span class="number">2</span>];&#125;tree[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> ls index&lt;&lt;1</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rs index&lt;&lt;1|1</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> L tree[index].l</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> R tree[index].r</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> W tree[index].w</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> C tree[index].c</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> lL tree[ls].l</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> lR tree[ls].r</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> lW tree[ls].w</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> lC tree[ls].c</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rL tree[rs].l</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rR tree[rs].r</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rW tree[rs].w</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rC tree[rs].c</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">(<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            W[<span class="number">0</span>]=lW[<span class="number">0</span>]*rW[<span class="number">0</span>];</span><br><span class="line">            W[<span class="number">1</span>]=lW[<span class="number">1</span>]*rW[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            L=l,R=r;</span><br><span class="line">            <span class="keyword">if</span> (l==r)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (a[l]==<span class="string">'A'</span>) &#123;W[<span class="number">0</span>]=A; W[<span class="number">1</span>]=B;&#125; <span class="comment">// W[0] 维护当前矩阵，W[1] 维护取反后的矩阵</span></span><br><span class="line">                <span class="keyword">else</span>           &#123;W[<span class="number">0</span>]=B; W[<span class="number">1</span>]=A;&#125; <span class="comment">// 这个边界显然吧...</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            Build(l,mid,ls); Build(mid+<span class="number">1</span>,r,rs);</span><br><span class="line">            Update(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">FlipOne</span><span class="params">(<span class="keyword">int</span> index=<span class="number">1</span>)</span> </span>&#123;C^=<span class="number">1</span>; swap(W[<span class="number">0</span>],W[<span class="number">1</span>]);&#125; <span class="comment">// 交换一下 W[0] 和 W[1]</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">PushDown</span><span class="params">(<span class="keyword">int</span> index=<span class="number">1</span>)</span> <span class="comment">//记得下传标记</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (C)</span><br><span class="line">            &#123;</span><br><span class="line">                FlipOne(ls); FlipOne(rs);</span><br><span class="line">                C=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Flip</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> index=<span class="number">1</span>)</span> <span class="comment">//区间反转</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (l&gt;R <span class="keyword">or</span> L&gt;r) <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">if</span> (l&lt;=L <span class="keyword">and</span> R&lt;=r) <span class="keyword">return</span> FlipOne(index);</span><br><span class="line">            PushDown(index);</span><br><span class="line">            Flip(l,r,ls); Flip(l,r,rs);</span><br><span class="line">            Update(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">Matrix <span class="title">Query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> index=<span class="number">1</span>)</span> <span class="comment">//注意：区间矩阵积返回的是一个矩阵</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (l&gt;R <span class="keyword">or</span> L&gt;r) <span class="keyword">return</span> I;</span><br><span class="line">            <span class="keyword">if</span> (l&lt;=L <span class="keyword">and</span> R&lt;=r) <span class="keyword">return</span> W[<span class="number">0</span>];</span><br><span class="line">            PushDown(index);</span><br><span class="line">            <span class="keyword">return</span> Query(l,r,ls)*Query(l,r,rs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;T;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Rd(<span class="number">2</span>,&amp;n,&amp;m);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>,a+<span class="number">1</span>);</span><br><span class="line">        A[<span class="number">1</span>][<span class="number">2</span>]=<span class="number">0</span>; B[<span class="number">2</span>][<span class="number">1</span>]=<span class="number">0</span>; I.Identity();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        A=</span></span><br><span class="line"><span class="comment">        [1 0]</span></span><br><span class="line"><span class="comment">        [1 1]</span></span><br><span class="line"><span class="comment">        B=</span></span><br><span class="line"><span class="comment">        [1 1]</span></span><br><span class="line"><span class="comment">        [0 1]</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        T.Build(<span class="number">1</span>,n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        F(i,<span class="number">1</span>,m)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> o;R1(o);</span><br><span class="line">            <span class="keyword">if</span> (o==<span class="number">1</span>) &#123;<span class="keyword">int</span> l,r;Rd(<span class="number">2</span>,&amp;l,&amp;r); T.Flip(l,r);&#125;</span><br><span class="line">            <span class="keyword">if</span> (o==<span class="number">2</span>) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> l,r,a,b; Rd(<span class="number">4</span>,&amp;l,&amp;r,&amp;a,&amp;b);</span><br><span class="line">                a%=mod; b%=mod;</span><br><span class="line">                <span class="function">Matrix <span class="title">Trans</span><span class="params">(<span class="number">2</span>,<span class="number">0</span>)</span></span>; Trans=T.Query(l,r); </span><br><span class="line">                <span class="comment">// 转移纠正</span></span><br><span class="line">                <span class="function">Matrix <span class="title">Init</span><span class="params">(<span class="number">2</span>,<span class="number">0</span>)</span></span>; Init[<span class="number">1</span>][<span class="number">1</span>]=a; Init[<span class="number">1</span>][<span class="number">2</span>]=b;</span><br><span class="line">                <span class="comment">// 初始矩阵就是 [A,B]</span></span><br><span class="line">                Init=Init*Trans;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>,Init[<span class="number">1</span>][<span class="number">1</span>],Init[<span class="number">1</span>][<span class="number">2</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line">    <span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Input();</span><br><span class="line">        Soviet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Flandre_Scarlet::IsMyWife();</span><br><span class="line">    getchar();getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="线段树" scheme="https://lightninguz2.github.io/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
      <category term="矩阵乘法" scheme="https://lightninguz2.github.io/tags/%E7%9F%A9%E9%98%B5%E4%B9%98%E6%B3%95/"/>
    
      <category term="转换思维" scheme="https://lightninguz2.github.io/tags/%E8%BD%AC%E6%8D%A2%E6%80%9D%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>libreoj 10069 「一本通 3.1 练习 4」Tree  题解</title>
    <link href="https://lightninguz2.github.io/2020/03/15/libreoj-10069-%E3%80%8C%E4%B8%80%E6%9C%AC%E9%80%9A-3-1-%E7%BB%83%E4%B9%A0-4%E3%80%8DTree-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/03/15/libreoj-10069-「一本通-3-1-练习-4」Tree-题解/</id>
    <published>2020-03-14T19:36:31.000Z</published>
    <updated>2020-03-14T19:37:31.967Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>一个图有 $n$ 个点 $m$ 条边，每个边是白色或黑色。生成一棵树使得白边的数量恰好是 $k$，并且边权和最小。输出最小的边权和。</p><p>$1\le n,m\le 10^5$，边权在 $[1,100]$ 之间</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>我们在跑朴素的 <code>Kruskal</code> 的时候，把每个白边都调的贵一点，或者便宜一点。把白边弄便宜的时候，就会多选几个白边，反之就会少选几个白边。</p><p>所以我们二分一个附加权值 $x$，可正可负。每个白边的权值都 <code>+=x</code> 。如果这样选出来的白边数量 $\le k$，那么 $x$ 应该更小一点（整便宜点，让我们可以多选几个），否则 $x$ 应该更大一点（同理）。</p><p>那么最后的答案就是 $sum-k\times x$。 （$sum$ 为附加值为 $x$ 时的最小生成树）<br>注意！是 $sum-k\times x$，而不是 $sum-white\times x$ （其中 $white$ 为选出的白边的数量）</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> N 155555</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">R1</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">        <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">        x=(f==<span class="number">1</span>)?x:-x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args;</span><br><span class="line">        va_start(args,cnt);</span><br><span class="line">        F(i,<span class="number">1</span>,cnt) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);R1(*x);</span><br><span class="line">        &#125;</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DSU</span> //并查集</span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">int</span> Fa[N],Cnt[N];</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;F(i,<span class="number">0</span>,N<span class="number">-1</span>) Fa[i]=i,Cnt[i]=<span class="number">1</span>;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">int</span>  <span class="title">Find</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;<span class="keyword">return</span> u==Fa[u]?u:Fa[u]=Find(Fa[u]);&#125;</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">Merge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> au=Find(u),av=Find(v);</span><br><span class="line">            <span class="keyword">if</span> (au==av) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (Cnt[au]&lt;Cnt[av]) Cnt[av]+=Cnt[au],Fa[au]=av;</span><br><span class="line">            <span class="keyword">else</span>                 Cnt[au]+=Cnt[av],Fa[av]=au;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;D;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span><span class="keyword">int</span> u,v,w,c;&#125;E[N]; <span class="comment">//存边</span></span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(Edge a,Edge b)&#123;<span class="keyword">return</span> a.w&lt;b.w <span class="keyword">or</span> (a.w==b.w <span class="keyword">and</span> a.c&lt;b.c);&#125;</span><br><span class="line">    <span class="keyword">int</span> n,m,k;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Rd(<span class="number">3</span>,&amp;n,&amp;m,&amp;k);</span><br><span class="line">        F(i,<span class="number">1</span>,m) &#123;<span class="keyword">int</span> u,v,w,c; Rd(<span class="number">4</span>,&amp;u,&amp;v,&amp;w,&amp;c); ++u,++v; E[i]=(Edge)&#123;u,v,w,c&#125;;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> sum=<span class="number">0</span>,white=<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">MST</span><span class="params">(<span class="keyword">int</span> delt)</span> <span class="comment">//delt为附加权值</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        sum=white=<span class="number">0</span>;</span><br><span class="line">        F(i,<span class="number">1</span>,m) <span class="keyword">if</span> (E[i].c==<span class="number">0</span>) E[i].w+=delt; <span class="comment">//每个白边权值都加上delt</span></span><br><span class="line">        D.Init(); </span><br><span class="line">        sort(E+<span class="number">1</span>,E+m+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">        F(i,<span class="number">1</span>,m) <span class="keyword">if</span> (D.Find(E[i].u)!=D.Find(E[i].v))</span><br><span class="line">        &#123;</span><br><span class="line">            D.Merge(E[i].u,E[i].v);</span><br><span class="line">            sum+=E[i].w;</span><br><span class="line">            white+=(E[i].c==<span class="number">0</span>);</span><br><span class="line">            ++cnt;</span><br><span class="line">            <span class="keyword">if</span> (cnt==n<span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        F(i,<span class="number">1</span>,m) <span class="keyword">if</span> (E[i].c==<span class="number">0</span>) E[i].w-=delt; <span class="comment">//记得改回来</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> l=<span class="number">-1000</span>,r=<span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">int</span> ans;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;=r)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>; MST(mid);</span><br><span class="line">            <span class="keyword">if</span> (white&gt;=k) ans=sum-k*mid,l=mid+<span class="number">1</span>;</span><br><span class="line">            <span class="comment">//答案是sum-k*mid，而不是sum-white*mid</span></span><br><span class="line">            <span class="keyword">else</span> r=mid<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line">    <span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Input();</span><br><span class="line">        Soviet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Flandre_Scarlet::IsMyWife();</span><br><span class="line">    getchar();getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="生成树" scheme="https://lightninguz2.github.io/tags/%E7%94%9F%E6%88%90%E6%A0%91/"/>
    
      <category term="wqs二分" scheme="https://lightninguz2.github.io/tags/wqs%E4%BA%8C%E5%88%86/"/>
    
  </entry>
  
  <entry>
    <title>点分治 笔记</title>
    <link href="https://lightninguz2.github.io/2020/03/15/%E7%82%B9%E5%88%86%E6%B2%BB-%E7%AC%94%E8%AE%B0/"/>
    <id>https://lightninguz2.github.io/2020/03/15/点分治-笔记/</id>
    <published>2020-03-14T19:16:26.000Z</published>
    <updated>2020-03-14T19:18:54.459Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="算法概述"><a href="#算法概述" class="headerlink" title="算法概述"></a>算法概述</h3><p>点分治用来统计树上满足某种条件的路径个数，一般具有可合并答案的性质（比如是否存在路径长度 $=k$等）。</p><h3 id="算法步骤"><a href="#算法步骤" class="headerlink" title="算法步骤"></a>算法步骤</h3><p>首先我们考虑经过根节点的满足条件的路径有多少。那比如我们就拿长度为 $k$ 举例，先从根节点 $DFS$ 一遍，求出每个节点的 $dis$。然后对于一个节点的 $dis[i]$，统计 $k-dis[i]$ 是否存在即可。如果存在，那么就有。</p><p>当然，并不是所有的路径都经过根节点。那么，不经过根节点的路径，一定经过根节点子树中的某个点。</p><p>那么我们把根节点的每个子树都分治一遍（递归），不就能求出答案了吗？</p><p>但是我们发现这样太慢了，复杂度为 $O(n\times C)$，其中 $C$ 为递归的次数。但是很显然，树为一条链的时候，$C=n$，复杂度变成 $O(n^2)$。</p><p>如何优化这个算法呢？也很简单，我们都有 $DFS$ 一遍的时间，顺便把每颗子树的重心都求出来好了。</p><p>然后对于每个子树，我们递归这个子树的时候，以重心为根。</p><p>这样，容易证明，递归次数 $C\le\log n$。</p><h3 id="模板题"><a href="#模板题" class="headerlink" title="模板题"></a>模板题</h3><p>洛谷 3806：给一颗树，多组询问是否存在长度为 $k$ 的路径。<br>$n\le 10^4,m\le 100$</p><p>解法：每次点分治的时候，维护一个 $bool$ 数组 $cxk$，$cxk[i]$ 表示是否存在 $dis[k]=i$。分治的时候，遍历每个询问 $k$，如果 $cxk[k-dis[i]]$，那么这个询问答案变成 $true$ （题目要求输出 <code>AYE</code>）</p><p>总的复杂度是 $O(nm\log n)$</p><h3 id="模板题代码"><a href="#模板题代码" class="headerlink" title="模板题代码"></a>模板题代码</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> N 155555</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> K 100000007</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">R1</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">        <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">        x=(f==<span class="number">1</span>)?x:-x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args;</span><br><span class="line">        va_start(args,cnt);</span><br><span class="line">        F(i,<span class="number">1</span>,cnt) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);R1(*x);</span><br><span class="line">        &#125;</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Graph</span> // 图</span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">            <span class="keyword">int</span> head[N];</span><br><span class="line">            <span class="keyword">int</span> EdgeCount;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span></span></span><br><span class="line"><span class="class">            &#123;</span></span><br><span class="line">                <span class="keyword">int</span> To,Label,Next;</span><br><span class="line">            &#125;Ed[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> _V=N,<span class="keyword">int</span> _E=N&lt;&lt;<span class="number">1</span>)</span> </span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                <span class="built_in">memset</span>(Ed,<span class="number">-1</span>,<span class="keyword">sizeof</span>(Edge)*(_E));</span><br><span class="line">                <span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="keyword">sizeof</span>(<span class="keyword">int</span>)*(_V));</span><br><span class="line">                EdgeCount=<span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> w=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                Ed[++EdgeCount]=(Edge)&#123;v,w,head[u]&#125;;</span><br><span class="line">                head[u]=EdgeCount;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">Add2</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> w=<span class="number">1</span>)</span> </span>&#123;AddEdge(u,v,w);AddEdge(v,u,w);&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">Start</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;<span class="keyword">return</span> head[u];&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">To</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> Ed[u].To;&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">Label</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> Ed[u].Label;&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">Next</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> Ed[u].Next;&#125;</span><br><span class="line">    &#125;G;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="keyword">int</span> q[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Rd(<span class="number">2</span>,&amp;n,&amp;m);</span><br><span class="line">        G.clear();</span><br><span class="line">        F(i,<span class="number">1</span>,n<span class="number">-1</span>) &#123;<span class="keyword">int</span> u,v,w;Rd(<span class="number">3</span>,&amp;u,&amp;v,&amp;w); G.Add2(u,v,w);&#125;</span><br><span class="line">        F(i,<span class="number">1</span>,m) &#123;R1(q[i]);&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> vis[N];</span><br><span class="line">    <span class="built_in">bitset</span>&lt;K&gt; cxk,test;</span><br><span class="line">    <span class="comment">// cxk[i]  表示是否存在 dis[k]=i</span></span><br><span class="line">    <span class="comment">// test[i] 表示第 i 个询问的答案</span></span><br><span class="line">    <span class="keyword">int</span> size[N],bal[N];</span><br><span class="line">    <span class="keyword">int</span> root,sum;</span><br><span class="line">    <span class="comment">// 这些是求重心的</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetBal</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        size[u]=<span class="number">1</span>; bal[u]=<span class="number">0</span>;</span><br><span class="line">        Tra(i,u) <span class="keyword">if</span> (v!=f <span class="keyword">and</span> !vis[v])</span><br><span class="line">        &#123;</span><br><span class="line">            GetBal(v,u);</span><br><span class="line">            size[u]+=size[v];</span><br><span class="line">            bal[u]=max(bal[u],size[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        bal[u]=max(bal[u],sum-size[u]);</span><br><span class="line">        <span class="keyword">if</span> (bal[u]&lt;bal[root]) root=u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> rec[N],dis[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetDis</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span> </span></span><br><span class="line"><span class="function">    <span class="comment">// 这个 DFS 用来求 dis，顺便把所有的 dis 数组记录在一个数组 rec 里</span></span></span><br><span class="line"><span class="function">    <span class="comment">// 由于是 1 编号，不用的 rec[0] 就用来存长度</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        rec[++rec[<span class="number">0</span>]]=dis[u];</span><br><span class="line">        Tra(i,u) <span class="keyword">if</span> (v!=f <span class="keyword">and</span> !vis[v])</span><br><span class="line">        &#123;</span><br><span class="line">            dis[v]=dis[u]+G.Label(i);</span><br><span class="line">            GetDis(v,u);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> u)</span> <span class="comment">// 计算以 u 为根的答案</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; d;</span><br><span class="line">        Tra(i,u) <span class="keyword">if</span> (!vis[v])</span><br><span class="line">        &#123;</span><br><span class="line">            rec[<span class="number">0</span>]=<span class="number">0</span>; dis[v]=G.Label(i);</span><br><span class="line">            GetDis(v,u);</span><br><span class="line"></span><br><span class="line">            D(j,rec[<span class="number">0</span>],<span class="number">1</span>) F(k,<span class="number">1</span>,m) <span class="keyword">if</span> (q[k]&gt;=rec[j]) <span class="comment">// 注意 q[k]&gt;=rec[j]</span></span><br><span class="line">            &#123;</span><br><span class="line">                test[k]=test[k]|cxk[q[k]-rec[j]];</span><br><span class="line">            &#125;</span><br><span class="line">            D(j,rec[<span class="number">0</span>],<span class="number">1</span>) &#123;d.p_b(rec[j]); cxk[rec[j]]=<span class="number">1</span>;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        F(i,<span class="number">0</span>,sz(d)<span class="number">-1</span>) cxk[d[i]]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        vis[u]=cxk[<span class="number">0</span>]=<span class="number">1</span>; </span><br><span class="line">        calc(u); <span class="comment">// 计算以 u 为根的答案</span></span><br><span class="line">        Tra(i,u) <span class="keyword">if</span> (!vis[v])</span><br><span class="line">        &#123;</span><br><span class="line">            sum=size[v]; bal[root=<span class="number">0</span>]=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line">            GetBal(v,v);</span><br><span class="line">            DFS(root); <span class="comment">//求出重心，递归子树</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        sum=bal[root=<span class="number">1</span>]=n;</span><br><span class="line">        GetBal(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        DFS(root);</span><br><span class="line">        F(i,<span class="number">1</span>,m) <span class="built_in">puts</span>(test[i]?<span class="string">"AYE"</span>:<span class="string">"NAY"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line">    <span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Input();</span><br><span class="line">        Soviet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Flandre_Scarlet::IsMyWife();</span><br><span class="line">    getchar();getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="点分治" scheme="https://lightninguz2.github.io/tags/%E7%82%B9%E5%88%86%E6%B2%BB/"/>
    
  </entry>
  
  <entry>
    <title>codeforces 916E Jamie and Tree 题解</title>
    <link href="https://lightninguz2.github.io/2020/03/15/codeforces-916E-Jamie-and-Tree-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/03/15/codeforces-916E-Jamie-and-Tree-题解/</id>
    <published>2020-03-14T17:47:11.000Z</published>
    <updated>2020-03-14T17:51:23.700Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>给定一个 $n\le 10^5$ 个点带权的树，初始根为 $1$。支持三种操作：<br><code>1 r</code> 把根换成 $r$<br><code>2 u v x</code> 把 $LCA(u,v)$ 的子树整体加 $x$<br><code>3 u</code> 查询 $u$ 的子树点权和</p><p>操作数$\le 10^5$。每个点权 $\le 10^8$ 。</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>如果没有 $1$ 操作，那 $2,3$ 操作显然就是一个板子。</p><p>但是现在有了 $1$ 操作。 那么我们就要考虑几个问题：</p><ol><li>如何求 LCA</li><li>如何知道子树是哪一块 （对其进行求和或加值）</li></ol><p>当然，无根树肯定是不好讨论的。我们先假定 $1$ 为根。 然后判断以 $r$ 为根的子树长什么样。</p><p>为了不混淆，设：<br>$LCA(u,v,r)$ 表示以 $r$ 为根，$u,v$ 的 $LCA$。<br>$SUB(u,r)$ 表示以 $r$ 为根，$u$ 的子树。</p><p>路径不需要重新定义，因为路径是唯一确定的，和根无关。</p><h4 id="求LCA"><a href="#求LCA" class="headerlink" title="求LCA"></a>求LCA</h4><p>假设我们要求 $LCA(u,v,r)$。</p><ol><li>如果当前的根 $r$ 在 $u,v$ 的路径上，那么显然 $LCA(u,v,r)=r$。</li><li>否则，设 $L=LCA(u,v,1)$。 如果当前的根在 $SUB(L,1)$ 外，那么 $LCA(u,v,r)=L$，就不会有影响</li><li>再否则，$LCA(u,v,r)$ 就是 $u,v$ 路径上的某个点了。稍微想一下，这个点是 $LCA(u,r,1)$ 或者 $LCA(v,r,1)$ 中的一个。 再仔细想想，似乎是选深的那一个（以 $1$ 为根）。那么如果同样深怎么办呢？<br>继续想想，$LCA(u,r,1)$ 和 $LCA(v,r,1)$ 肯定一个是 $LCA(u,v,1)$ ，一个是 $LCA(u,v,r)$。如果深度相同，那就说明 $LCA(u,r,1)=LCA(v,r,1)=LCA(u,v,1)$ 。这个时候选哪个也无所谓了，反正都是对的。</li></ol><h4 id="求某个子树"><a href="#求某个子树" class="headerlink" title="求某个子树"></a>求某个子树</h4><p>假设我们要求 $SUB(u,r)$</p><ol><li>$u=r$。 最简单的情况，子树就是整棵树 （<strong>但是不能忘记特判！</strong>）</li><li>$r$ 在 $SUB(u,1)$ 之外。 这也很显然，$SUB(u,r)=SUB(u,1)$。</li><li>关键问题就是 $r$ 在 $SUB(u,1)$ 之内的情况咋整。</li></ol><p>我们画一张图：<br><img src="https://lightninguz2.github.io/blogimages/CF916E-2.jpg" alt></p><p>很明显，此时 $SUB(u,r)$ 就等于整棵树中减去 $SUB(k,1)。（这张图有一个没画全的地方，就是 $u$ 上面可能还有别的点）</p><p>而 $k$ 的值，也就是 $r$ 在 $u$ 的哪个子树里面，这个可以用倍增求。</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>我们发现，最后的操作，只有子树加减，和单点求和的操作。甚至不用写树链剖分。这个用 $DFS$ 序维护就能解决。</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> N 255555</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> int long long </span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">R1</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">        <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">        x=(f==<span class="number">1</span>)?x:-x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args;</span><br><span class="line">        va_start(args,cnt);</span><br><span class="line">        F(i,<span class="number">1</span>,cnt) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);R1(*x);</span><br><span class="line">        &#125;</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Graph</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">            <span class="keyword">int</span> head[N];</span><br><span class="line">            <span class="keyword">int</span> EdgeCount;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span></span></span><br><span class="line"><span class="class">            &#123;</span></span><br><span class="line">                <span class="keyword">int</span> To,Label,Next;</span><br><span class="line">            &#125;Ed[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> _V=N,<span class="keyword">int</span> _E=N&lt;&lt;<span class="number">1</span>)</span> </span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                <span class="built_in">memset</span>(Ed,<span class="number">-1</span>,<span class="keyword">sizeof</span>(Edge)*(_E));</span><br><span class="line">                <span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="keyword">sizeof</span>(<span class="keyword">int</span>)*(_V));</span><br><span class="line">                EdgeCount=<span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> w=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                Ed[++EdgeCount]=(Edge)&#123;v,w,head[u]&#125;;</span><br><span class="line">                head[u]=EdgeCount;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">Add2</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> w=<span class="number">1</span>)</span> </span>&#123;AddEdge(u,v,w);AddEdge(v,u,w);&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">Start</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;<span class="keyword">return</span> head[u];&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">To</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> Ed[u].To;&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">Label</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> Ed[u].Label;&#125;</span><br><span class="line">            <span class="function"><span class="keyword">int</span> <span class="title">Next</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="keyword">return</span> Ed[u].Next;&#125;</span><br><span class="line">    &#125;G;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">SegmentTree</span> //线段树 区间加 区间求和</span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span><span class="keyword">int</span> l,r,s,a;&#125;tree[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> ls index&lt;&lt;1</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rs index&lt;&lt;1|1</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> L tree[index].l</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> R tree[index].r</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> S tree[index].s</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> A tree[index].a</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> lL tree[ls].l</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> lR tree[ls].r</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> lS tree[ls].s</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> lA tree[ls].a</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rL tree[rs].l</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rR tree[rs].r</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rS tree[rs].s</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rA tree[rs].a</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">(<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            S=lS+rS;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            L=l,R=r;S=A=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (l==r) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">            <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            Build(l,mid,ls); Build(mid+<span class="number">1</span>,r,rs);</span><br><span class="line">            Update(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">AddOne</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            A+=x;</span><br><span class="line">            S+=(R-L+<span class="number">1</span>)*x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">PushDown</span><span class="params">(<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (A) &#123;AddOne(A,ls); AddOne(A,rs); A=<span class="number">0</span>;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (l&gt;R <span class="keyword">or</span> L&gt;r) <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">if</span> (l&lt;=L <span class="keyword">and</span> R&lt;=r) <span class="keyword">return</span> AddOne(x,index);</span><br><span class="line">            PushDown(index);</span><br><span class="line">            Add(l,r,x,ls); Add(l,r,x,rs);</span><br><span class="line">            Update(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">int</span>  <span class="title">Query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (l&gt;R <span class="keyword">or</span> L&gt;r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (l&lt;=L <span class="keyword">and</span> R&lt;=r) <span class="keyword">return</span> S;</span><br><span class="line">            PushDown(index);</span><br><span class="line">            <span class="keyword">return</span> Query(l,r,ls)+Query(l,r,rs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;T;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Rd(<span class="number">2</span>,&amp;n,&amp;m);</span><br><span class="line">        F(i,<span class="number">1</span>,n) R1(a[i]);</span><br><span class="line">        G.clear();</span><br><span class="line">        F(i,<span class="number">1</span>,n<span class="number">-1</span>) &#123;<span class="keyword">int</span> u,v;Rd(<span class="number">2</span>,&amp;u,&amp;v); G.Add2(u,v);&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> In[N],Out[N],Time=<span class="number">0</span>; </span><br><span class="line">    <span class="keyword">int</span> fa[N][<span class="number">22</span>],deep[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        In[u]=++Time;</span><br><span class="line">        deep[u]=(u==f)?<span class="number">0</span>:deep[f]+<span class="number">1</span>;</span><br><span class="line">        fa[u][<span class="number">0</span>]=f; F(i,<span class="number">1</span>,<span class="number">20</span>) fa[u][i]=fa[fa[u][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">        Tra(i,u) <span class="keyword">if</span> (v!=f)</span><br><span class="line">        &#123;</span><br><span class="line">            DFS(v,u);</span><br><span class="line">        &#125;</span><br><span class="line">        Out[u]=Time;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">FindSon</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span> <span class="comment">//求 u 在 f 的哪个子树里 （u相对于f的k值）</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        D(i,<span class="number">20</span>,<span class="number">0</span>) <span class="keyword">if</span> (deep[fa[u][i]]&gt;deep[f]) u=fa[u][i];</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IsFa</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span> <span class="comment">//这个判断f是否是u的祖先</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (deep[u]&lt;deep[f]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (u==f) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> fa[FindSon(u,f)][<span class="number">0</span>]==f;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//upd: 傻了，这个直接DFS序判断即可</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (deep[u]&lt;deep[v]) swap(u,v);</span><br><span class="line">        D(i,<span class="number">20</span>,<span class="number">0</span>) <span class="keyword">if</span> (deep[fa[u][i]]&gt;=deep[v]) u=fa[u][i];</span><br><span class="line">        <span class="keyword">if</span> (u==v) <span class="keyword">return</span> u;</span><br><span class="line">        D(i,<span class="number">20</span>,<span class="number">0</span>) <span class="keyword">if</span> (fa[u][i]!=fa[v][i]) u=fa[u][i],v=fa[v][i];</span><br><span class="line">        <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//非常正常的LCA</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">OnPath</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> l=LCA(u,v);</span><br><span class="line">        <span class="keyword">if</span> (l==k) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> !IsFa(l,k) <span class="keyword">and</span> (IsFa(u,k) <span class="keyword">or</span> IsFa(v,k));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断k是否在u,v路径上</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SubtAdd</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> x)</span></span>&#123;T.Add(In[u],Out[u],x);&#125;</span><br><span class="line">    <span class="comment">//子树加</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span>  <span class="title">SubtSum</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;<span class="keyword">return</span> T.Query(In[u],Out[u]);&#125;</span><br><span class="line">    <span class="comment">//子树求和</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        DFS(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        T.Build(<span class="number">1</span>,n);</span><br><span class="line">        F(i,<span class="number">1</span>,n) T.Add(In[i],In[i],a[i]); <span class="comment">//初始化</span></span><br><span class="line">        <span class="keyword">int</span> root=<span class="number">1</span>; <span class="comment">//这个别忘了</span></span><br><span class="line">        F(i,<span class="number">1</span>,m)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> o;R1(o);</span><br><span class="line">            <span class="keyword">if</span> (o==<span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> u;R1(u);</span><br><span class="line">                root=u; <span class="comment">//非常简单的换根操作</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (o==<span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> u,v,x;Rd(<span class="number">3</span>,&amp;u,&amp;v,&amp;x);</span><br><span class="line">                <span class="keyword">int</span> l=LCA(u,v);</span><br><span class="line">                <span class="keyword">if</span> (OnPath(u,v,root)) </span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//特判: 如果root在u,v路径上，那么LCA(u,v,root)==root，直接加整个树</span></span><br><span class="line">                    T.Add(<span class="number">1</span>,n,x);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (In[root]&lt;In[l] <span class="keyword">or</span> Out[l]&lt;In[root]) </span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//如果root不在x子树内，那么没有影响，和根为1情况一样</span></span><br><span class="line">                    SubtAdd(l,x);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    T.Add(<span class="number">1</span>,n,x); <span class="comment">//整个加</span></span><br><span class="line">                    <span class="keyword">if</span> (deep[LCA(root,u)]&lt;deep[LCA(root,v)]) swap(u,v);</span><br><span class="line">                    <span class="keyword">int</span> k=FindSon(root,LCA(root,u));</span><br><span class="line">                    <span class="comment">//找到k</span></span><br><span class="line">                    SubtAdd(k,-x);</span><br><span class="line">                    <span class="comment">//把k的子树减掉</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (o==<span class="number">3</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> u;R1(u);</span><br><span class="line">                <span class="comment">//这个和上面类似的</span></span><br><span class="line">                <span class="keyword">if</span> (root==u) </span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,T.Query(<span class="number">1</span>,n));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (In[root]&lt;In[u] <span class="keyword">or</span> Out[u]&lt;In[root]) </span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,SubtSum(u));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> </span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">int</span> k=FindSon(root,u);</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,T.Query(<span class="number">1</span>,n)-SubtSum(k));</span><br><span class="line">                    <span class="comment">//整棵树-k的子树</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line">    <span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Input();</span><br><span class="line">        Soviet();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">undef</span> int <span class="comment">//long long </span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Flandre_Scarlet::IsMyWife();</span><br><span class="line">    getchar();getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="毒瘤" scheme="https://lightninguz2.github.io/tags/%E6%AF%92%E7%98%A4/"/>
    
      <category term="树形结构" scheme="https://lightninguz2.github.io/tags/%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84/"/>
    
      <category term="倍增" scheme="https://lightninguz2.github.io/tags/%E5%80%8D%E5%A2%9E/"/>
    
      <category term="DFS序" scheme="https://lightninguz2.github.io/tags/DFS%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>libreoj 125 除数函数求和2 题解</title>
    <link href="https://lightninguz2.github.io/2020/03/14/libreoj-125-%E9%99%A4%E6%95%B0%E5%87%BD%E6%95%B0%E6%B1%82%E5%92%8C2-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/03/14/libreoj-125-除数函数求和2-题解/</id>
    <published>2020-03-14T12:59:35.000Z</published>
    <updated>2020-03-14T13:15:23.731Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>给定 $n$，求 $\sum\limits_{i=1}^{n} 2\sigma_2(i)+3\sigma_1(i)+5\sigma_0(i)$</p><p>$n&lt;=1e9$</p><p>其中 $\sigma_k(x)=x$ 所有因数的 $k$ 次方和。</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>我们反过来想，枚举每个因数对答案产生了多少贡献。</p><p>显然，一个因数 $d$ 对答案产生的贡献就是 $2d^2+3d+5$。</p><p>那么有多少 $i$ 算到了这个 $d$ 呢？只要是 $d$ 的倍数，都能算到，所以一共有 $\lfloor \dfrac{n}{d}\rfloor$ 个。</p><p>答案变成了 $\sum\limits_{d=1}^{n} (2d^2+3d+5)\lfloor \dfrac{n}{d}\rfloor$</p><p>整除分块，一次 $O(\sqrt{n})$</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> int long long </span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> mod 998244353</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> i2  499122177</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> i6  166374059</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),__v=G.To(i);~i;i=G.Next(i),__v=G.To(i))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">R1</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">        <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">        x=(f==<span class="number">1</span>)?x:-x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args;</span><br><span class="line">        va_start(args,cnt);</span><br><span class="line">        F(i,<span class="number">1</span>,cnt) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);R1(*x);</span><br><span class="line">        &#125;</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        R1(n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">s1</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;x%=mod; <span class="keyword">return</span> x*(x+<span class="number">1</span>)%mod*i2%mod;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">s2</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;x%=mod; <span class="keyword">return</span> x*(x+<span class="number">1</span>)%mod*(<span class="number">2</span>*x+<span class="number">1</span>)%mod*i6%mod;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">S</span><span class="params">(<span class="keyword">int</span> x)</span>  </span>&#123;<span class="keyword">return</span> <span class="number">5</span>*x%mod+<span class="number">3</span>*s1(x)%mod+<span class="number">2</span>*s2(x)%mod;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> l=<span class="number">1</span>,r;l&lt;=n;l=r+<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            r=n/(n/l);</span><br><span class="line">            ans+=(n/l)%mod*(S(r)-S(l<span class="number">-1</span>)+mod)%mod;</span><br><span class="line">            ans%=mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line">    <span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Input();</span><br><span class="line">        Soviet();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">undef</span> int <span class="comment">//long long </span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Flandre_Scarlet::IsMyWife();</span><br><span class="line">    getchar();getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="思维" scheme="https://lightninguz2.github.io/tags/%E6%80%9D%E7%BB%B4/"/>
    
      <category term="数论" scheme="https://lightninguz2.github.io/tags/%E6%95%B0%E8%AE%BA/"/>
    
  </entry>
  
  <entry>
    <title>libreoj 6029 「雅礼集训 2017 Day1」市场  题解</title>
    <link href="https://lightninguz2.github.io/2020/03/03/libreoj-6029-%E3%80%8C%E9%9B%85%E7%A4%BC%E9%9B%86%E8%AE%AD-2017-Day1%E3%80%8D%E5%B8%82%E5%9C%BA-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/03/03/libreoj-6029-「雅礼集训-2017-Day1」市场-题解/</id>
    <published>2020-03-03T11:42:50.000Z</published>
    <updated>2020-03-06T08:50:00.952Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>给定一个长度为 $n\le 10^5$ 的序列，初始值$\le 10^9$，支持：<br><code>1 l r x</code> 区间 $[l,r]$ 每个数加上 $x$ 。 $|x|&lt;=10^4,1\le l\le r\le n$<br><code>2 l r x</code> 区间 $[l,r]$ 每个数除以 $x$ （下取整），$2\le x\le 1e9,1\le l\le r\le n$<br><code>3 l r</code> 求 $[l,r]$ 中的最小值<br><code>4 l r</code> 求 $[l,r]$ 的和<br>询问数 $\le 10^5$</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>显然线段树。</p><p>我们把区间除法分解成区间内每个数都减去某个数。设 $d(a,x)$ 表示 $a$ 除以 $x$ 下取整的变化量，也就是 $a-a/x$。那么 $a\leftarrow a/x$ 的操作，就等价于 $a\leftarrow a-d(a,x)$。显然，当 $x$ 相同的时候， $d$ 函数单调不减。具体的说，如果 $a&lt;b$，则 $d(a,x)\le d(b,x)$ ，对于所有正整数 $x$。</p><p>那么对于一段区间，如果 $d(Max,x)=d(Min,x)$，那么这个区间中，所有数的变化量都一样了，直接上区间减法来解决。</p><p>否则我们继续把这个区间分成左右两个部分，直到这个区间满足上述条件即可。</p><h3 id="分析复杂度"><a href="#分析复杂度" class="headerlink" title="分析复杂度"></a>分析复杂度</h3><p>那么这个算法的复杂度是多少呢？看起来每次的最坏情况是暴力的 $O(r-l+1)$ ，但是我们注意到，加法操作中的 $x$ 最大才加 $10000$，但是一次除法操作每次至少除以 $2$。 </p><p>那比如我是毒瘤出题人，我要卡我的代码，那肯定是要尽量多的加法操作（因为会减慢除法操作），但是也不能少了除法操作（因为看起来很慢）。那假设数据里有 $5\times 10^4$ 个加法操作，还有 $5\times 10^4$ 个除法操作。然后每个数一开始都是 $10^9$ 的规模（不一定恰好是 $10^9$ ，全部相同反而会加快除法操作）。</p><p>那加完之后每个数都是 $1.5\times 10^9$ 左右。那么我们把它除个 $31$ 次就全部变成 $0$ 了，那肯定变化量相同，就是能用 $O(log)$ 的减法操作实现了。</p><p>那总共就相当于 $O(n \log n \log a)$ ，其中 $a$ 是初始的值域，$\log a$ 大约要到 $32$ 了。</p><h3 id="代码-今天测试一下展开功能"><a href="#代码-今天测试一下展开功能" class="headerlink" title="代码 (今天测试一下展开功能)"></a>代码 (今天测试一下展开功能)</h3><div><div class="fold_hider"><div class="close hider_title">点击</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> N 155555</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> int long long </span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),__v=G.To(i);~i;i=G.Next(i),__v=G.To(i))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">R1</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">        <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">        x=(f==<span class="number">1</span>)?x:-x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args;</span><br><span class="line">        va_start(args,cnt);</span><br><span class="line">        F(i,<span class="number">1</span>,cnt) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);R1(*x);</span><br><span class="line">        &#125;</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">SegmentTree</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span><span class="keyword">int</span> l,r,s,m,x,a;&#125;tree[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> ls index&lt;&lt;1</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rs index&lt;&lt;1|1</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> L tree[index].l</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> R tree[index].r</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> S tree[index].s</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> M tree[index].m</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> X tree[index].x</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> A tree[index].a</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> lL tree[ls].l</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> lR tree[ls].r</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> lS tree[ls].s</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> lM tree[ls].m</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> lX tree[ls].x</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> lA tree[ls].a</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rL tree[rs].l</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rR tree[rs].r</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rS tree[rs].s</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rM tree[rs].m</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rX tree[rs].x</span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> rA tree[rs].a</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">(<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            S=lS+rS;</span><br><span class="line">            M=min(lM,rM);</span><br><span class="line">            X=max(lX,rX);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            L=l,R=r; A=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (l==r) &#123;R1(S);M=X=S;<span class="keyword">return</span>;&#125;</span><br><span class="line">            <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            Build(l,mid,ls); Build(mid+<span class="number">1</span>,r,rs);</span><br><span class="line">            Update(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">AddOne</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            A+=x; M+=x; X+=x;</span><br><span class="line">            S+=(R-L+<span class="number">1</span>)*x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">PushDown</span><span class="params">(<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (A)</span><br><span class="line">            &#123;</span><br><span class="line">                AddOne(A,ls); AddOne(A,rs);</span><br><span class="line">                A=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (l&gt;R <span class="keyword">or</span> L&gt;r) <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">if</span> (l&lt;=L <span class="keyword">and</span> R&lt;=r) <span class="keyword">return</span> AddOne(x,index);</span><br><span class="line">            PushDown(index);</span><br><span class="line">            Add(l,r,x,ls); Add(l,r,x,rs);</span><br><span class="line">            Update(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">fld</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> aa=<span class="built_in">abs</span>(a),bb=<span class="built_in">abs</span>(b);</span><br><span class="line">            <span class="keyword">if</span> ((a&gt;<span class="number">0</span>)^(b&gt;<span class="number">0</span>)) <span class="keyword">return</span> -(aa+bb<span class="number">-1</span>)/bb;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> aa/bb;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Div</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> d,<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (l&gt;R <span class="keyword">or</span> L&gt;r) <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">if</span> (l&lt;=L <span class="keyword">and</span> R&lt;=r)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> dmax=X-fld(X,d),dmin=M-fld(M,d);</span><br><span class="line">                <span class="keyword">if</span> (dmax==dmin)</span><br><span class="line">                &#123;</span><br><span class="line">                    AddOne(-dmax,index);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            PushDown(index);</span><br><span class="line">            Div(l,r,d,ls); Div(l,r,d,rs);</span><br><span class="line">            Update(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">QueryMin</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (l&gt;R <span class="keyword">or</span> L&gt;r) <span class="keyword">return</span> <span class="number">0x3f3f3f3f3f3f3f3f</span>ll;</span><br><span class="line">            <span class="keyword">if</span> (l&lt;=L <span class="keyword">and</span> R&lt;=r) <span class="keyword">return</span> M;</span><br><span class="line">            PushDown(index);</span><br><span class="line">            <span class="keyword">return</span> min(QueryMin(l,r,ls),QueryMin(l,r,rs));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">QuerySum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> index=<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (l&gt;R <span class="keyword">or</span> L&gt;r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (l&lt;=L <span class="keyword">and</span> R&lt;=r) <span class="keyword">return</span> S;</span><br><span class="line">            PushDown(index);</span><br><span class="line">            <span class="keyword">return</span> QuerySum(l,r,ls)+QuerySum(l,r,rs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;T;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Rd(<span class="number">2</span>,&amp;n,&amp;m);</span><br><span class="line">        T.Build(<span class="number">1</span>,n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        F(i,<span class="number">1</span>,m)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> o,l,r;Rd(<span class="number">3</span>,&amp;o,&amp;l,&amp;r);</span><br><span class="line">            ++l,++r;</span><br><span class="line">            <span class="keyword">if</span> (o==<span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> x;R1(x);T.Add(l,r,x);</span><br><span class="line">                <span class="comment">// F(i,1,n) printf("%lld ",T.QuerySum(i,i)); putchar('\n'); </span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (o==<span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> d;R1(d);T.Div(l,r,d);</span><br><span class="line">                <span class="comment">// F(i,1,n) printf("%lld ",T.QuerySum(i,i)); putchar('\n'); </span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (o==<span class="number">3</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,T.QueryMin(l,r));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (o==<span class="number">4</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,T.QuerySum(l,r));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line">    <span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Input();</span><br><span class="line">        Soviet();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">undef</span> int <span class="comment">//long long </span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Flandre_Scarlet::IsMyWife();</span><br><span class="line">    getchar();getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="思维" scheme="https://lightninguz2.github.io/tags/%E6%80%9D%E7%BB%B4/"/>
    
      <category term="线段树" scheme="https://lightninguz2.github.io/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>noi.ac 357 partner 题解</title>
    <link href="https://lightninguz2.github.io/2020/03/03/noi-ac-357-partner-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lightninguz2.github.io/2020/03/03/noi-ac-357-partner-题解/</id>
    <published>2020-03-03T10:57:10.000Z</published>
    <updated>2020-03-03T11:05:18.902Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题意简述"><a href="#题意简述" class="headerlink" title="题意简述"></a>题意简述</h3><p>（数据结构做傻了系列）<br>给你一列数，求有多少对$(i,j)$满足 $0.9a_j\le a_i\le a_j$。</p><h3 id="思路框架"><a href="#思路框架" class="headerlink" title="思路框架"></a>思路框架</h3><p>显然先排序，设 $b_i=0.9a_i$ （<code>double</code>型即可），然后每次 $lower_bound$找一下即珂。</p><p>像这样的水题我居然会想用树状数组做…我也是数据结构做傻了</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> Flandre_Scarlet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> N 255555</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> int long long </span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> real double</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> F(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> D(i,r,l) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Fs(i,l,r,c) for(int i=l;i&lt;=r;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Ds(i,r,l,c) for(int i=r;i&gt;=l;c)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> MEM(x,a) memset(x,a,sizeof(x))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> FK(x) MEM(x,0)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Tra(i,u) for(int i=G.Start(u),__v=G.To(i);~i;i=G.Next(i),__v=G.To(i))</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sz(a) ((int)a.size())</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> iter(a,p) (a.begin()+p)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">R1</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x=<span class="number">0</span>;<span class="keyword">char</span> c=getchar();<span class="keyword">int</span> f=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(c&lt;<span class="string">'0'</span> <span class="keyword">or</span> c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</span><br><span class="line">        <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span> <span class="keyword">and</span> c&lt;=<span class="string">'9'</span>) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+(c^<span class="number">48</span>),c=getchar();</span><br><span class="line">        x=(f==<span class="number">1</span>)?x:-x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rd</span><span class="params">(<span class="keyword">int</span> cnt,...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args;</span><br><span class="line">        va_start(args,cnt);</span><br><span class="line">        F(i,<span class="number">1</span>,cnt) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span>* x=va_arg(args,<span class="keyword">int</span>*);R1(*x);</span><br><span class="line">        &#125;</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> n,a[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        R1(n); F(i,<span class="number">1</span>,n) R1(a[i]);</span><br><span class="line">        sort(a+<span class="number">1</span>,a+n+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    real b[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Soviet</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        F(i,<span class="number">1</span>,n) b[i]=a[i]*<span class="number">0.9</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        F(i,<span class="number">1</span>,n<span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> p2=upper_bound(b+i+<span class="number">1</span>,b+n+<span class="number">1</span>,(real)a[i])-b<span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">int</span> p1=lower_bound(a+i+<span class="number">1</span>,a+p2,a[i])-a;</span><br><span class="line">            ans+=p2-p1+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> Flan void</span></span><br><span class="line">    <span class="function">Flan <span class="title">IsMyWife</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Input();</span><br><span class="line">        Soviet();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">undef</span> int <span class="comment">//long long </span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Flandre_Scarlet::IsMyWife();</span><br><span class="line">    getchar();getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="思维" scheme="https://lightninguz2.github.io/tags/%E6%80%9D%E7%BB%B4/"/>
    
      <category term="二分答案" scheme="https://lightninguz2.github.io/tags/%E4%BA%8C%E5%88%86%E7%AD%94%E6%A1%88/"/>
    
      <category term="水题" scheme="https://lightninguz2.github.io/tags/%E6%B0%B4%E9%A2%98/"/>
    
  </entry>
  
</feed>
